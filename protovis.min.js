var a;if(!Array.prototype.map)Array.prototype.map=function(b,c){for(var f=this.length,d=new Array(f),g=0;g<f;g++)if(g in this)d[g]=b.call(c,this[g],g,this);return d};if(!Array.prototype.filter)Array.prototype.filter=function(b,c){for(var f=this.length,d=[],g=0;g<f;g++)if(g in this){var h=this[g];b.call(c,h,g,this)&&d.push(h)}return d};if(!Array.prototype.forEach)Array.prototype.forEach=function(b,c){for(var f=this.length>>>0,d=0;d<f;d++)d in this&&b.call(c,this[d],d,this)};
if(!Array.prototype.reduce)Array.prototype.reduce=function(b,c){var f=this.length;if(!f&&arguments.length==1)throw new Error("reduce: empty array, no initial value");var d=0;if(arguments.length<2)for(;;){if(d in this){c=this[d++];break}if(++d>=f)throw new Error("reduce: no values, no initial value");}for(;d<f;d++)if(d in this)c=b(c,this[d],d,this);return c};var pv={};pv.version="3.3.1";pv.identity=function(b){return b};pv.index=function(){return this.index};pv.child=function(){return this.childIndex};
pv.parent=function(){return this.parent.index};pv.extend=function(b){function c(){}c.prototype=b.prototype||b;return new c};
try{eval("pv.parse = function(x) x;")}catch(e){pv.parse=function(b){for(var c=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),f,d,g=0,h="";f=c.exec(b);){f=f.index+f[0].length;if(b.charAt(f)!="{"){h+=b.substring(g,f)+"{return ";g=f;for(var i=0;i>=0&&f<b.length;f++){var j=b.charAt(f);switch(j){case '"':case "'":for(;++f<b.length&&(d=b.charAt(f))!=j;)d=="\\"&&f++;break;case "[":case "(":i++;break;case "]":case ")":i--;break;case ";":case ",":i==0&&i--;break}}h+=pv.parse(b.substring(g,--f))+
";}";g=f}c.lastIndex=f}h+=b.substring(g);return h}}pv.css=function(b,c){return window.getComputedStyle?window.getComputedStyle(b,null).getPropertyValue(c):b.currentStyle[c]};pv.error=function(b){typeof console=="undefined"?alert(b):console.error(b)};pv.listen=function(b,c,f){f=pv.listener(f);return b.addEventListener?b.addEventListener(c,f,false):b.attachEvent("on"+c,f)};pv.listener=function(b){return b.$listener||(b.$listener=function(c){try{pv.event=c;return b.call(this,c)}finally{delete pv.event}})};
pv.ancestor=function(b,c){for(;c;){if(c==b)return true;c=c.parentNode}return false};pv.id=function(){var b=1;return function(){return b++}}();pv.functor=function(b){return typeof b=="function"?b:function(){return b}};pv.listen(window,"load",function(){for(pv.$={i:0,x:document.getElementsByTagName("script")};pv.$.i<pv.$.x.length;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis")try{window.eval(pv.parse(pv.$.s.text))}catch(b){pv.error(b)}}delete pv.$});pv.Format={};
pv.Format.re=function(b){return b.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")};pv.Format.pad=function(b,c,f){c=c-String(f).length;return c<1?f:(new Array(c+1)).join(b)+f};
pv.Format.date=function(b){function c(d){return b.replace(/%[a-zA-Z0-9]/g,function(g){switch(g){case "%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()];case "%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][d.getDay()];case "%h":case "%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][d.getMonth()];case "%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][d.getMonth()];
case "%c":return d.toLocaleString();case "%C":return f("0",2,Math.floor(d.getFullYear()/100)%100);case "%d":return f("0",2,d.getDate());case "%x":case "%D":return f("0",2,d.getMonth()+1)+"/"+f("0",2,d.getDate())+"/"+f("0",2,d.getFullYear()%100);case "%e":return f(" ",2,d.getDate());case "%H":return f("0",2,d.getHours());case "%I":return(g=d.getHours()%12)?f("0",2,g):12;case "%m":return f("0",2,d.getMonth()+1);case "%M":return f("0",2,d.getMinutes());case "%n":return"\n";case "%p":return d.getHours()<
12?"AM":"PM";case "%T":case "%X":case "%r":g=d.getHours()%12;return(g?f("0",2,g):12)+":"+f("0",2,d.getMinutes())+":"+f("0",2,d.getSeconds())+" "+(d.getHours()<12?"AM":"PM");case "%R":return f("0",2,d.getHours())+":"+f("0",2,d.getMinutes());case "%S":return f("0",2,d.getSeconds());case "%Q":return f("0",3,d.getMilliseconds());case "%t":return"\t";case "%u":return(g=d.getDay())?g:1;case "%w":return d.getDay();case "%y":return f("0",2,d.getFullYear()%100);case "%Y":return d.getFullYear();case "%%":return"%"}return g})}
var f=pv.Format.pad;c.format=c;c.parse=function(d){var g=1970,h=0,i=1,j=0,l=0,k=0,q=[function(){}],n=pv.Format.re(b).replace(/%[a-zA-Z0-9]/g,function(p){switch(p){case "%b":q.push(function(m){h={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[m]});return"([A-Za-z]+)";case "%h":case "%B":q.push(function(m){h={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[m]});return"([A-Za-z]+)";case "%e":case "%d":q.push(function(m){i=
m});return"([0-9]+)";case "%I":case "%H":q.push(function(m){j=m});return"([0-9]+)";case "%m":q.push(function(m){h=m-1});return"([0-9]+)";case "%M":q.push(function(m){l=m});return"([0-9]+)";case "%p":q.push(function(m){if(j==12){if(m=="am")j=0}else if(m=="pm")j=Number(j)+12});return"(am|pm)";case "%S":q.push(function(m){k=m});return"([0-9]+)";case "%y":q.push(function(m){m=Number(m);g=m+(0<=m&&m<69?2E3:m>=69&&m<100?1900:0)});return"([0-9]+)";case "%Y":q.push(function(m){g=m});return"([0-9]+)";case "%%":q.push(function(){});
return"%"}return p});(d=d.match(n))&&d.forEach(function(p,m){q[m](p)});return new Date(g,h,i,j,l,k)};return c};
pv.Format.time=function(b){function c(d){d=Number(d);switch(b){case "short":if(d>=31536E6)return(d/31536E6).toFixed(1)+" years";else if(d>=6048E5)return(d/6048E5).toFixed(1)+" weeks";else if(d>=864E5)return(d/864E5).toFixed(1)+" days";else if(d>=36E5)return(d/36E5).toFixed(1)+" hours";else if(d>=6E4)return(d/6E4).toFixed(1)+" minutes";return(d/1E3).toFixed(1)+" seconds";case "long":var g=[],h=d%36E5/6E4>>0;g.push(f("0",2,d%6E4/1E3>>0));if(d>=36E5){var i=d%864E5/36E5>>0;g.push(f("0",2,h));if(d>=864E5){g.push(f("0",
2,i));g.push(Math.floor(d/864E5).toFixed())}else g.push(i.toFixed())}else g.push(h.toFixed());return g.reverse().join(":")}}var f=pv.Format.pad;c.format=c;c.parse=function(d){switch(b){case "short":for(var g=/([0-9,.]+)\s*([a-z]+)/g,h,i=0;h=g.exec(d);){var j=parseFloat(h[0].replace(",","")),l=0;switch(h[2].toLowerCase()){case "year":case "years":l=31536E6;break;case "week":case "weeks":l=6048E5;break;case "day":case "days":l=864E5;break;case "hour":case "hours":l=36E5;break;case "minute":case "minutes":l=
6E4;break;case "second":case "seconds":l=1E3;break}i+=j*l}return i;case "long":h=d.replace(",","").split(":").reverse();i=0;if(h.length)i+=parseFloat(h[0])*1E3;if(h.length>1)i+=parseFloat(h[1])*6E4;if(h.length>2)i+=parseFloat(h[2])*36E5;if(h.length>3)i+=parseFloat(h[3])*864E5;return i}};return c};
pv.Format.number=function(){function b(r){if(Infinity>h)r=Math.round(r*i)/i;var s=String(Math.abs(r)).split("."),t=s[0];if(t.length>f)t=t.substring(t.length-f);if(k&&t.length<c)t=(new Array(c-t.length+1)).join(j)+t;if(t.length>3)t=t.replace(/\B(?=(?:\d{3})+(?!\d))/g,n);if(!k&&t.length<d)t=(new Array(d-t.length+1)).join(j)+t;s[0]=r<0?p+t+m:t;r=s[1]||"";if(r.length<g)s[1]=r+(new Array(g-r.length+1)).join(l);return s.join(q)}var c=0,f=Infinity,d=0,g=0,h=0,i=1,j="0",l="0",k=true,q=".",n=",",p="\u2212",
m="";b.format=b;b.parse=function(r){var s=pv.Format.re;r=String(r).replace(new RegExp("^("+s(j)+")*"),"").replace(new RegExp("("+s(l)+")*$"),"").split(q);s=r[0].replace(new RegExp(s(n),"g"),"");if(s.length>f)s=s.substring(s.length-f);r=r[1]?Number("0."+r[1]):0;if(Infinity>h)r=Math.round(r*i)/i;return Math.round(s)+r};b.integerDigits=function(r,s){if(arguments.length){c=Number(r);f=arguments.length>1?Number(s):c;d=c+Math.floor(c/3)*n.length;return this}return[c,f]};b.fractionDigits=function(r,s){if(arguments.length){g=
Number(r);h=arguments.length>1?Number(s):g;i=Math.pow(10,h);return this}return[g,h]};b.integerPad=function(r){if(arguments.length){j=String(r);k=/\d/.test(j);return this}return j};b.fractionPad=function(r){if(arguments.length){l=String(r);return this}return l};b.decimal=function(r){if(arguments.length){q=String(r);return this}return q};b.group=function(r){if(arguments.length){n=r?String(r):"";d=c+Math.floor(c/3)*n.length;return this}return n};b.negativeAffix=function(r,s){if(arguments.length){p=String(r||
"");m=String(s||"");return this}return[p,m]};return b};pv.map=function(b,c){var f={};return c?b.map(function(d,g){f.index=g;return c.call(f,d)}):b.slice()};pv.repeat=function(b,c){if(arguments.length==1)c=2;return pv.blend(pv.range(c).map(function(){return b}))};pv.cross=function(b,c){for(var f=[],d=0,g=b.length,h=c.length;d<g;d++)for(var i=0,j=b[d];i<h;i++)f.push([j,c[i]]);return f};pv.blend=function(b){return Array.prototype.concat.apply([],b)};
pv.transpose=function(b){var c=b.length,f=pv.max(b,function(i){return i.length});if(f>c){b.length=f;for(var d=c;d<f;d++)b[d]=new Array(c);for(d=0;d<c;d++)for(var g=d+1;g<f;g++){var h=b[d][g];b[d][g]=b[g][d];b[g][d]=h}}else{for(d=0;d<f;d++)b[d].length=c;for(d=0;d<c;d++)for(g=0;g<d;g++){h=b[d][g];b[d][g]=b[g][d];b[g][d]=h}}b.length=f;for(d=0;d<f;d++)b[d].length=c;return b};pv.normalize=function(b,c){b=pv.map(b,c);c=pv.sum(b);for(var f=0;f<b.length;f++)b[f]/=c;return b};
pv.permute=function(b,c,f){if(!f)f=pv.identity;var d=new Array(c.length),g={};c.forEach(function(h,i){g.index=h;d[i]=f.call(g,b[h])});return d};pv.numerate=function(b,c){if(!c)c=pv.identity;var f={},d={};b.forEach(function(g,h){d.index=h;f[c.call(d,g)]=h});return f};pv.uniq=function(b,c){if(!c)c=pv.identity;var f={},d=[],g={},h;b.forEach(function(i,j){g.index=j;h=c.call(g,i);h in f||(f[h]=d.push(h))});return d};pv.naturalOrder=function(b,c){return b<c?-1:b>c?1:0};
pv.reverseOrder=function(b,c){return c<b?-1:c>b?1:0};pv.search=function(b,c,f){if(!f)f=pv.identity;for(var d=0,g=b.length-1;d<=g;){var h=d+g>>1,i=f(b[h]);if(i<c)d=h+1;else if(i>c)g=h-1;else return h}return-d-1};pv.search.index=function(b,c,f){b=pv.search(b,c,f);return b<0?-b-1:b};
pv.range=function(b,c,f){if(arguments.length==1){c=b;b=0}if(f==undefined)f=1;if((c-b)/f==Infinity)throw new Error("range must be finite");var d=[],g=0,h;c-=(c-b)*1.0E-10;if(f<0)for(;(h=b+f*g++)>c;)d.push(h);else for(;(h=b+f*g++)<c;)d.push(h);return d};pv.random=function(b,c,f){if(arguments.length==1){c=b;b=0}if(f==undefined)f=1;return f?Math.floor(Math.random()*(c-b)/f)*f+b:Math.random()*(c-b)+b};
pv.sum=function(b,c){var f={};return b.reduce(c?function(d,g,h){f.index=h;return d+c.call(f,g)}:function(d,g){return d+g},0)};pv.max=function(b,c){if(c==pv.index)return b.length-1;return Math.max.apply(null,c?pv.map(b,c):b)};pv.max.index=function(b,c){if(!b.length)return-1;if(c==pv.index)return b.length-1;if(!c)c=pv.identity;for(var f=0,d=-Infinity,g={},h=0;h<b.length;h++){g.index=h;var i=c.call(g,b[h]);if(i>d){d=i;f=h}}return f};
pv.min=function(b,c){if(c==pv.index)return 0;return Math.min.apply(null,c?pv.map(b,c):b)};pv.min.index=function(b,c){if(!b.length)return-1;if(c==pv.index)return 0;if(!c)c=pv.identity;for(var f=0,d=Infinity,g={},h=0;h<b.length;h++){g.index=h;var i=c.call(g,b[h]);if(i<d){d=i;f=h}}return f};pv.mean=function(b,c){return pv.sum(b,c)/b.length};
pv.median=function(b,c){if(c==pv.index)return(b.length-1)/2;b=pv.map(b,c).sort(pv.naturalOrder);if(b.length%2)return b[Math.floor(b.length/2)];c=b.length/2;return(b[c-1]+b[c])/2};pv.variance=function(b,c){if(b.length<1)return NaN;if(b.length==1)return 0;var f=pv.mean(b,c),d=0,g={};if(!c)c=pv.identity;for(var h=0;h<b.length;h++){g.index=h;var i=c.call(g,b[h])-f;d+=i*i}return d};pv.deviation=function(b,c){return Math.sqrt(pv.variance(b,c)/(b.length-1))};pv.log=function(b,c){return Math.log(b)/Math.log(c)};
pv.logSymmetric=function(b,c){return b==0?0:b<0?-pv.log(-b,c):pv.log(b,c)};pv.logAdjusted=function(b,c){if(!isFinite(b))return b;var f=b<0;if(b<c)b+=(c-b)/c;return f?-pv.log(b,c):pv.log(b,c)};pv.logFloor=function(b,c){return b>0?Math.pow(c,Math.floor(pv.log(b,c))):-Math.pow(c,-Math.floor(-pv.log(-b,c)))};pv.logCeil=function(b,c){return b>0?Math.pow(c,Math.ceil(pv.log(b,c))):-Math.pow(c,-Math.ceil(-pv.log(-b,c)))};
(function(){var b=Math.PI/180,c=180/Math.PI;pv.radians=function(f){return b*f};pv.degrees=function(f){return c*f}})();pv.keys=function(b){var c=[];for(var f in b)c.push(f);return c};pv.entries=function(b){var c=[];for(var f in b)c.push({key:f,value:b[f]});return c};pv.values=function(b){var c=[];for(var f in b)c.push(b[f]);return c};pv.dict=function(b,c){for(var f={},d={},g=0;g<b.length;g++)if(g in b){var h=b[g];d.index=g;f[h]=c.call(d,h)}return f};pv.dom=function(b){return new pv.Dom(b)};
pv.Dom=function(b){this.$map=b};pv.Dom.prototype.$leaf=function(b){return typeof b!="object"};pv.Dom.prototype.leaf=function(b){if(arguments.length){this.$leaf=b;return this}return this.$leaf};pv.Dom.prototype.root=function(b){function c(g){var h=new pv.Dom.Node;for(var i in g){var j=g[i];h.appendChild(f(j)?new pv.Dom.Node(j):c(j)).nodeName=i}return h}var f=this.$leaf,d=c(this.$map);d.nodeName=b;return d};pv.Dom.prototype.nodes=function(){return this.root().nodes()};
pv.Dom.Node=function(b){this.nodeValue=b;this.childNodes=[]};a=pv.Dom.Node.prototype;a.parentNode=null;a.firstChild=null;a.lastChild=null;a.previousSibling=null;a.nextSibling=null;
a.removeChild=function(b){var c=this.childNodes.indexOf(b);if(c==-1)throw new Error("child not found");this.childNodes.splice(c,1);if(b.previousSibling)b.previousSibling.nextSibling=b.nextSibling;else this.firstChild=b.nextSibling;if(b.nextSibling)b.nextSibling.previousSibling=b.previousSibling;else this.lastChild=b.previousSibling;delete b.nextSibling;delete b.previousSibling;delete b.parentNode;return b};
a.appendChild=function(b){b.parentNode&&b.parentNode.removeChild(b);b.parentNode=this;if(b.previousSibling=this.lastChild)this.lastChild.nextSibling=b;else this.firstChild=b;this.lastChild=b;this.childNodes.push(b);return b};
a.insertBefore=function(b,c){if(!c)return this.appendChild(b);var f=this.childNodes.indexOf(c);if(f==-1)throw new Error("child not found");b.parentNode&&b.parentNode.removeChild(b);b.parentNode=this;b.nextSibling=c;if(b.previousSibling=c.previousSibling)c.previousSibling.nextSibling=b;else{if(c==this.lastChild)this.lastChild=b;this.firstChild=b}this.childNodes.splice(f,0,b);return b};
a.replaceChild=function(b,c){var f=this.childNodes.indexOf(c);if(f==-1)throw new Error("child not found");b.parentNode&&b.parentNode.removeChild(b);b.parentNode=this;b.nextSibling=c.nextSibling;if(b.previousSibling=c.previousSibling)c.previousSibling.nextSibling=b;else this.firstChild=b;if(c.nextSibling)c.nextSibling.previousSibling=b;else this.lastChild=b;this.childNodes[f]=b;return c};a.visitBefore=function(b){function c(f,d){b(f,d);for(f=f.firstChild;f;f=f.nextSibling)c(f,d+1)}c(this,0)};
a.visitAfter=function(b){function c(f,d){for(var g=f.firstChild;g;g=g.nextSibling)c(g,d+1);b(f,d)}c(this,0)};a.sort=function(b){if(this.firstChild){this.childNodes.sort(b);var c=this.firstChild=this.childNodes[0],f;delete c.previousSibling;for(var d=1;d<this.childNodes.length;d++){c.sort(b);f=this.childNodes[d];f.previousSibling=c;c=c.nextSibling=f}this.lastChild=c;delete c.nextSibling;c.sort(b)}return this};
a.reverse=function(){var b=[];this.visitAfter(function(c){for(;c.lastChild;)b.push(c.removeChild(c.lastChild));for(var f;f=b.pop();)c.insertBefore(f,c.firstChild)});return this};a.nodes=function(){function b(f){c.push(f);f.childNodes.forEach(b)}var c=[];b(this,c);return c};
a.toggle=function(b){if(b)return this.toggled?this.visitBefore(function(f){f.toggled&&f.toggle()}):this.visitAfter(function(f){f.toggled||f.toggle()});b=this;if(b.toggled){for(var c;c=b.toggled.pop();)b.appendChild(c);delete b.toggled}else if(b.lastChild)for(b.toggled=[];b.lastChild;)b.toggled.push(b.removeChild(b.lastChild))};pv.nodes=function(b){for(var c=new pv.Dom.Node,f=0;f<b.length;f++)c.appendChild(new pv.Dom.Node(b[f]));return c.nodes()};pv.tree=function(b){return new pv.Tree(b)};
pv.Tree=function(b){this.array=b};pv.Tree.prototype.keys=function(b){this.k=b;return this};pv.Tree.prototype.value=function(b){this.v=b;return this};pv.Tree.prototype.map=function(){for(var b={},c={},f=0;f<this.array.length;f++){c.index=f;for(var d=this.array[f],g=this.k.call(c,d),h=b,i=0;i<g.length-1;i++)h=h[g[i]]||(h[g[i]]={});h[g[i]]=this.v?this.v.call(c,d):d}return b};pv.nest=function(b){return new pv.Nest(b)};pv.Nest=function(b){this.array=b;this.keys=[]};a=pv.Nest.prototype;
a.key=function(b){this.keys.push(b);return this};a.sortKeys=function(b){this.keys[this.keys.length-1].order=b||pv.naturalOrder;return this};a.sortValues=function(b){this.order=b||pv.naturalOrder;return this};a.map=function(){for(var b={},c=[],f,d=0;d<this.array.length;d++){var g=this.array[d],h=b;for(f=0;f<this.keys.length-1;f++){var i=this.keys[f](g);h[i]||(h[i]={});h=h[i]}i=this.keys[f](g);if(!h[i]){f=[];c.push(f);h[i]=f}h[i].push(g)}if(this.order)for(f=0;f<c.length;f++)c[f].sort(this.order);return b};
a.entries=function(){function b(f){var d=[];for(var g in f){var h=f[g];d.push({key:g,values:h instanceof Array?h:b(h)})}return d}function c(f,d){var g=this.keys[d].order;g&&f.sort(function(i,j){return g(i.key,j.key)});if(++d<this.keys.length)for(var h=0;h<f.length;h++)c.call(this,f[h].values,d);return f}return c.call(this,b(this.map()),0)};a.rollup=function(b){function c(f){for(var d in f){var g=f[d];if(g instanceof Array)f[d]=b(g);else c(g)}return f}return c(this.map())};pv.flatten=function(b){return new pv.Flatten(b)};
pv.Flatten=function(b){this.map=b;this.keys=[]};pv.Flatten.prototype.key=function(b,c){this.keys.push({name:b,value:c});delete this.$leaf;return this};pv.Flatten.prototype.leaf=function(b){this.keys.length=0;this.$leaf=b;return this};
pv.Flatten.prototype.array=function(){function b(i,j){if(j<d.length-1)for(var l in i){f.push(l);b(i[l],j+1);f.pop()}else c.push(f.concat(i))}var c=[],f=[],d=this.keys,g=this.$leaf;if(g){function h(i,j){if(g(i))c.push({keys:f.slice(),value:i});else for(var l in i){f.push(l);h(i[l],j+1);f.pop()}}h(this.map,0);return c}b(this.map,0);return c.map(function(i){for(var j={},l=0;l<d.length;l++){var k=d[l],q=i[l];j[k.name]=k.value?k.value.call(null,q):q}return j})};
pv.vector=function(b,c){return new pv.Vector(b,c)};pv.Vector=function(b,c){this.x=b;this.y=c};a=pv.Vector.prototype;a.perp=function(){return new pv.Vector(-this.y,this.x)};a.norm=function(){var b=this.length();return this.times(b?1/b:1)};a.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.times=function(b){return new pv.Vector(this.x*b,this.y*b)};a.plus=function(b,c){return arguments.length==1?new pv.Vector(this.x+b.x,this.y+b.y):new pv.Vector(this.x+b,this.y+c)};
a.minus=function(b,c){return arguments.length==1?new pv.Vector(this.x-b.x,this.y-b.y):new pv.Vector(this.x-b,this.y-c)};a.dot=function(b,c){return arguments.length==1?this.x*b.x+this.y*b.y:this.x*b+this.y*c};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform;pv.Transform.prototype.translate=function(b,c){var f=new pv.Transform;f.k=this.k;f.x=this.k*b+this.x;f.y=this.k*c+this.y;return f};
pv.Transform.prototype.scale=function(b){var c=new pv.Transform;c.k=this.k*b;c.x=this.x;c.y=this.y;return c};pv.Transform.prototype.invert=function(){var b=new pv.Transform,c=1/this.k;b.k=c;b.x=-this.x*c;b.y=-this.y*c;return b};pv.Transform.prototype.times=function(b){var c=new pv.Transform;c.k=this.k*b.k;c.x=this.k*b.x+this.x;c.y=this.k*b.y+this.y;return c};pv.Scale=function(){};
pv.Scale.interpolator=function(b,c){if(typeof b=="number")return function(f){return f*(c-b)+b};b=pv.color(b).rgb();c=pv.color(c).rgb();return function(f){var d=b.a*(1-f)+c.a*f;if(d<1.0E-5)d=0;return b.a==0?pv.rgb(c.r,c.g,c.b,d):c.a==0?pv.rgb(b.r,b.g,b.b,d):pv.rgb(Math.round(b.r*(1-f)+c.r*f),Math.round(b.g*(1-f)+c.g*f),Math.round(b.b*(1-f)+c.b*f),d)}};
pv.Scale.quantitative=function(){function b(n){return new Date(n)}function c(n){var p=pv.search(f,n);if(p<0)p=-p-2;p=Math.max(0,Math.min(h.length-1,p));return h[p]((l(n)-d[p])/(d[p+1]-d[p]))}var f=[0,1],d=[0,1],g=[0,1],h=[pv.identity],i=Number,j=false,l=pv.identity,k=pv.identity,q=String;c.transform=function(n,p){l=function(m){return j?-n(-m):n(m)};k=function(m){return j?-p(-m):p(m)};d=f.map(l);return this};c.domain=function(n,p,m){if(arguments.length){var r;if(n instanceof Array){if(arguments.length<
2)p=pv.identity;if(arguments.length<3)m=p;r=n.length&&p(n[0]);f=n.length?[pv.min(n,p),pv.max(n,m)]:[]}else{r=n;f=Array.prototype.slice.call(arguments).map(Number)}if(f.length){if(f.length==1)f=[f[0],f[0]]}else f=[-Infinity,Infinity];j=(f[0]||f[f.length-1])<0;d=f.map(l);i=r instanceof Date?b:Number;return this}return f.map(i)};c.range=function(){if(arguments.length){g=Array.prototype.slice.call(arguments);if(g.length){if(g.length==1)g=[g[0],g[0]]}else g=[-Infinity,Infinity];h=[];for(var n=0;n<g.length-
1;n++)h.push(pv.Scale.interpolator(g[n],g[n+1]));return this}return g};c.invert=function(n){var p=pv.search(g,n);if(p<0)p=-p-2;p=Math.max(0,Math.min(h.length-1,p));return i(k(d[p]+(n-g[p])/(g[p+1]-g[p])*(d[p+1]-d[p])))};c.ticks=function(n){var p=f[0],m=f[f.length-1],r=m<p,s=r?m:p;m=r?p:m;var t=m-s;if(!t||!isFinite(t)){if(i==b)q=pv.Format.date("%x");return[i(s)]}if(i==b){function x(w,y){switch(y){case 31536E6:w.setMonth(0);case 2592E6:w.setDate(1);case 6048E5:y==6048E5&&w.setDate(w.getDate()-w.getDay());
case 864E5:w.setHours(0);case 36E5:w.setMinutes(0);case 6E4:w.setSeconds(0);case 1E3:w.setMilliseconds(0)}}var u,o,v=1;if(t>=94608E6){p=31536E6;u="%Y";o=function(w){w.setFullYear(w.getFullYear()+v)}}else if(t>=7776E6){p=2592E6;u="%m/%Y";o=function(w){w.setMonth(w.getMonth()+v)}}else if(t>=18144E5){p=6048E5;u="%m/%d";o=function(w){w.setDate(w.getDate()+7*v)}}else if(t>=2592E5){p=864E5;u="%m/%d";o=function(w){w.setDate(w.getDate()+v)}}else if(t>=108E5){p=36E5;u="%I:%M %p";o=function(w){w.setHours(w.getHours()+
v)}}else if(t>=18E4){p=6E4;u="%I:%M %p";o=function(w){w.setMinutes(w.getMinutes()+v)}}else if(t>=3E3){p=1E3;u="%I:%M:%S";o=function(w){w.setSeconds(w.getSeconds()+v)}}else{p=1;u="%S.%Qs";o=function(w){w.setTime(w.getTime()+v)}}q=pv.Format.date(u);s=new Date(s);u=[];x(s,p);t=t/p;if(t>10)switch(p){case 36E5:v=t>20?6:3;s.setHours(Math.floor(s.getHours()/v)*v);break;case 2592E6:v=3;s.setMonth(Math.floor(s.getMonth()/v)*v);break;case 6E4:v=t>30?15:t>15?10:5;s.setMinutes(Math.floor(s.getMinutes()/v)*v);
break;case 1E3:v=t>90?15:t>60?10:5;s.setSeconds(Math.floor(s.getSeconds()/v)*v);break;case 1:v=t>1E3?250:t>200?100:t>100?50:t>50?25:5;s.setMilliseconds(Math.floor(s.getMilliseconds()/v)*v);break;default:v=pv.logCeil(t/15,10);if(t/v<2)v/=5;else if(t/v<5)v/=2;s.setFullYear(Math.floor(s.getFullYear()/v)*v);break}for(;;){o(s);if(s>m)break;u.push(new Date(s))}return r?u.reverse():u}arguments.length||(n=10);v=pv.logFloor(t/n,10);p=n/(t/v);if(p<=0.15)v*=10;else if(p<=0.35)v*=5;else if(p<=0.75)v*=2;p=Math.ceil(s/
v)*v;m=Math.floor(m/v)*v;q=pv.Format.number().fractionDigits(Math.max(0,-Math.floor(pv.log(v,10)+0.01)));m=pv.range(p,m+v,v);return r?m.reverse():m};c.tickFormat=function(n){return q(n)};c.nice=function(){if(f.length!=2)return this;var n=f[0],p=f[f.length-1],m=p<n,r=m?p:n;n=m?n:p;p=n-r;if(!p||!isFinite(p))return this;p=Math.pow(10,Math.round(Math.log(p)/Math.log(10))-1);f=[Math.floor(r/p)*p,Math.ceil(n/p)*p];m&&f.reverse();d=f.map(l);return this};c.by=function(n){function p(){return c(n.apply(this,
arguments))}for(var m in c)p[m]=c[m];return p};c.domain.apply(c,arguments);return c};pv.Scale.linear=function(){var b=pv.Scale.quantitative();b.domain.apply(b,arguments);return b};
pv.Scale.log=function(){var b=pv.Scale.quantitative(1,10),c,f,d=function(h){return Math.log(h)/f},g=function(h){return Math.pow(c,h)};b.ticks=function(){var h=b.domain(),i=h[0]<0,j=Math.floor(i?-d(-h[0]):d(h[0])),l=Math.ceil(i?-d(-h[1]):d(h[1])),k=[];if(i)for(k.push(-g(-j));j++<l;)for(i=c-1;i>0;i--)k.push(-g(-j)*i);else{for(;j<l;j++)for(i=1;i<c;i++)k.push(g(j)*i);k.push(g(j))}for(j=0;k[j]<h[0];j++);for(l=k.length;k[l-1]>h[1];l--);return k.slice(j,l)};b.tickFormat=function(h){return h.toPrecision(1)};
b.nice=function(){var h=b.domain();return b.domain(pv.logFloor(h[0],c),pv.logCeil(h[1],c))};b.base=function(h){if(arguments.length){c=Number(h);f=Math.log(c);b.transform(d,g);return this}return c};b.domain.apply(b,arguments);return b.base(10)};pv.Scale.root=function(){var b=pv.Scale.quantitative();b.power=function(c){if(arguments.length){var f=Number(c),d=1/f;b.transform(function(g){return Math.pow(g,d)},function(g){return Math.pow(g,f)});return this}return f};b.domain.apply(b,arguments);return b.power(2)};
pv.Scale.ordinal=function(){function b(g){g in f||(f[g]=c.push(g)-1);return d[f[g]%d.length]}var c=[],f={},d=[];b.domain=function(g,h){if(arguments.length){g=g instanceof Array?arguments.length>1?pv.map(g,h):g:Array.prototype.slice.call(arguments);c=[];for(var i={},j=0;j<g.length;j++){var l=g[j];if(!(l in i)){i[l]=true;c.push(l)}}f=pv.numerate(c);return this}return c};b.range=function(g,h){if(arguments.length){d=g instanceof Array?arguments.length>1?pv.map(g,h):g:Array.prototype.slice.call(arguments);
if(typeof d[0]=="string")d=d.map(pv.color);return this}return d};b.split=function(g,h){var i=(h-g)/this.domain().length;d=pv.range(g+i/2,h,i);return this};b.splitFlush=function(g,h){var i=this.domain().length,j=(h-g)/(i-1);d=i==1?[(g+h)/2]:pv.range(g,h+j/2,j);return this};b.splitBanded=function(g,h,i){if(arguments.length<3)i=1;if(i<0){var j=this.domain().length;j=(h-g- -i*j)/(j+1);d=pv.range(g+j,h,j-i);d.band=-i}else{j=(h-g)/(this.domain().length+(1-i));d=pv.range(g+j*(1-i),h,j);d.band=j*i}return this};
b.by=function(g){function h(){return b(g.apply(this,arguments))}for(var i in b)h[i]=b[i];return h};b.domain.apply(b,arguments);return b};
pv.Scale.quantile=function(){function b(i){return h(Math.max(0,Math.min(f,pv.search.index(d,i)-1))/f)}var c=-1,f=-1,d=[],g=[],h=pv.Scale.linear();b.quantiles=function(i){if(arguments.length){c=Number(i);if(c<0){d=[g[0]].concat(g);f=g.length-1}else{d=[];d[0]=g[0];for(var j=1;j<=c;j++)d[j]=g[~~(j*(g.length-1)/c)];f=c-1}return this}return d};b.domain=function(i,j){if(arguments.length){g=i instanceof Array?pv.map(i,j):Array.prototype.slice.call(arguments);g.sort(pv.naturalOrder);b.quantiles(c);return this}return g};
b.range=function(){if(arguments.length){h.range.apply(h,arguments);return this}return h.range()};b.by=function(i){function j(){return b(i.apply(this,arguments))}for(var l in b)j[l]=b[l];return j};b.domain.apply(b,arguments);return b};
pv.histogram=function(b,c){var f=true;return{bins:function(d){var g=pv.map(b,c),h=[];arguments.length||(d=pv.Scale.linear(g).ticks());for(var i=0;i<d.length-1;i++){var j=h[i]=[];j.x=d[i];j.dx=d[i+1]-d[i];j.y=0}for(i=0;i<g.length;i++){j=pv.search.index(d,g[i])-1;j=h[Math.max(0,Math.min(h.length-1,j))];j.y++;j.push(b[i])}if(!f)for(i=0;i<h.length;i++)h[i].y/=g.length;return h},frequency:function(d){if(arguments.length){f=Boolean(d);return this}return f}}};
pv.color=function(b){if(b.rgb)return b.rgb();var c=/([a-z]+)\((.*)\)/i.exec(b);if(c){var f=c[2].split(","),d=1;switch(c[1]){case "hsla":case "rgba":d=parseFloat(f[3]);if(!d)return pv.Color.transparent;break}switch(c[1]){case "hsla":case "hsl":b=parseFloat(f[0]);var g=parseFloat(f[1])/100;f=parseFloat(f[2])/100;return(new pv.Color.Hsl(b,g,f,d)).rgb();case "rgba":case "rgb":function h(l){var k=parseFloat(l);return l[l.length-1]=="%"?Math.round(k*2.55):k}g=h(f[0]);var i=h(f[1]),j=h(f[2]);return pv.rgb(g,
i,j,d)}}if(d=pv.Color.names[b])return d;if(b.charAt(0)=="#"){if(b.length==4){g=b.charAt(1);g+=g;i=b.charAt(2);i+=i;j=b.charAt(3);j+=j}else if(b.length==7){g=b.substring(1,3);i=b.substring(3,5);j=b.substring(5,7)}return pv.rgb(parseInt(g,16),parseInt(i,16),parseInt(j,16),1)}return new pv.Color(b,1)};pv.Color=function(b,c){this.color=b;this.opacity=c};pv.Color.prototype.brighter=function(b){return this.rgb().brighter(b)};pv.Color.prototype.darker=function(b){return this.rgb().darker(b)};
pv.rgb=function(b,c,f,d){return new pv.Color.Rgb(b,c,f,arguments.length==4?d:1)};pv.Color.Rgb=function(b,c,f,d){pv.Color.call(this,d?"rgb("+b+","+c+","+f+")":"none",d);this.r=b;this.g=c;this.b=f;this.a=d};pv.Color.Rgb.prototype=pv.extend(pv.Color);a=pv.Color.Rgb.prototype;a.red=function(b){return pv.rgb(b,this.g,this.b,this.a)};a.green=function(b){return pv.rgb(this.r,b,this.b,this.a)};a.blue=function(b){return pv.rgb(this.r,this.g,b,this.a)};
a.alpha=function(b){return pv.rgb(this.r,this.g,this.b,b)};a.rgb=function(){return this};a.brighter=function(b){b=Math.pow(0.7,arguments.length?b:1);var c=this.r,f=this.g,d=this.b;if(!c&&!f&&!d)return pv.rgb(30,30,30,this.a);if(c&&c<30)c=30;if(f&&f<30)f=30;if(d&&d<30)d=30;return pv.rgb(Math.min(255,Math.floor(c/b)),Math.min(255,Math.floor(f/b)),Math.min(255,Math.floor(d/b)),this.a)};
a.darker=function(b){b=Math.pow(0.7,arguments.length?b:1);return pv.rgb(Math.max(0,Math.floor(b*this.r)),Math.max(0,Math.floor(b*this.g)),Math.max(0,Math.floor(b*this.b)),this.a)};pv.hsl=function(b,c,f,d){return new pv.Color.Hsl(b,c,f,arguments.length==4?d:1)};pv.Color.Hsl=function(b,c,f,d){pv.Color.call(this,"hsl("+b+","+c*100+"%,"+f*100+"%)",d);this.h=b;this.s=c;this.l=f;this.a=d};pv.Color.Hsl.prototype=pv.extend(pv.Color);a=pv.Color.Hsl.prototype;
a.hue=function(b){return pv.hsl(b,this.s,this.l,this.a)};a.saturation=function(b){return pv.hsl(this.h,b,this.l,this.a)};a.lightness=function(b){return pv.hsl(this.h,this.s,b,this.a)};a.alpha=function(b){return pv.hsl(this.h,this.s,this.l,b)};
a.rgb=function(){function b(j){if(j>360)j-=360;else if(j<0)j+=360;if(j<60)return i+(h-i)*j/60;if(j<180)return h;if(j<240)return i+(h-i)*(240-j)/60;return i}function c(j){return Math.round(b(j)*255)}var f=this.h,d=this.s,g=this.l;f%=360;if(f<0)f+=360;d=Math.max(0,Math.min(d,1));g=Math.max(0,Math.min(g,1));var h=g<=0.5?g*(1+d):g+d-g*d,i=2*g-h;return pv.rgb(c(f+120),c(f),c(f-120),this.a)};
pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",
darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",
ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",
lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",
moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",
seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)};(function(){var b=pv.Color.names;for(var c in b)b[c]=pv.color(b[c])})();
pv.colors=function(){var b=pv.Scale.ordinal();b.range.apply(b,arguments);return b};pv.Colors={};pv.Colors.category10=function(){var b=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");b.domain.apply(b,arguments);return b};
pv.Colors.category20=function(){var b=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");b.domain.apply(b,arguments);return b};
pv.Colors.category19=function(){var b=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");b.domain.apply(b,arguments);return b};pv.ramp=function(){var b=pv.Scale.linear();b.range.apply(b,arguments);return b};
pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter"},
css:{font:"10px sans-serif"}}};pv.SvgScene.updateAll=function(b){if(b.length&&b[0].reverse&&b.type!="line"&&b.type!="area"){for(var c=pv.extend(b),f=0,d=b.length-1;d>=0;f++,d--)c[f]=b[d];b=c}this.removeSiblings(this[b.type](b))};pv.SvgScene.create=function(b){return document.createElementNS(this.svg,b)};
pv.SvgScene.expect=function(b,c,f,d){if(b){if(b.tagName=="a")b=b.firstChild;if(b.tagName!=c){c=this.create(c);b.parentNode.replaceChild(c,b);b=c}}else b=this.create(c);for(var g in f){c=f[g];if(c==this.implicit.svg[g])c=null;c==null?b.removeAttribute(g):b.setAttribute(g,c)}for(g in d){c=d[g];if(c==this.implicit.css[g])c=null;if(c==null)b.style.removeProperty(g);else b.style[g]=c}return b};
pv.SvgScene.append=function(b,c,f){b.$scene={scenes:c,index:f};b=this.title(b,c[f]);b.parentNode||c.$g.appendChild(b);return b.nextSibling};pv.SvgScene.title=function(b,c){var f=b.parentNode;if(f&&f.tagName!="a")f=null;if(c.title){if(!f){f=this.create("a");b.parentNode&&b.parentNode.replaceChild(f,b);f.appendChild(b)}f.setAttributeNS(this.xlink,"title",c.title);return f}f&&f.parentNode.replaceChild(b,f);return b};
pv.SvgScene.dispatch=pv.listener(function(b){var c=b.target.$scene;if(c){var f=b.type;switch(f){case "DOMMouseScroll":f="mousewheel";b.wheel=-480*b.detail;break;case "mousewheel":b.wheel=(window.opera?12:1)*b.wheelDelta;break}pv.Mark.dispatch(f,c.scenes,c.index)&&b.preventDefault()}});pv.SvgScene.removeSiblings=function(b){for(;b;){var c=b.nextSibling;b.parentNode.removeChild(b);b=c}};pv.SvgScene.undefined=function(){};
pv.SvgScene.pathBasis=function(){function b(d,g,h,i,j){return{x:d[0]*g.left+d[1]*h.left+d[2]*i.left+d[3]*j.left,y:d[0]*g.top+d[1]*h.top+d[2]*i.top+d[3]*j.top}}var c=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]],f=function(d,g,h,i){var j=b(c[1],d,g,h,i),l=b(c[2],d,g,h,i);d=b(c[3],d,g,h,i);return"C"+j.x+","+j.y+","+l.x+","+l.y+","+d.x+","+d.y};f.segment=function(d,g,h,i){var j=b(c[0],d,g,h,i),l=b(c[1],d,g,h,i),k=b(c[2],d,g,h,i);d=b(c[3],d,g,h,i);return"M"+j.x+","+j.y+"C"+l.x+","+l.y+
","+k.x+","+k.y+","+d.x+","+d.y};return f}();pv.SvgScene.curveBasis=function(b){if(b.length<=2)return"";var c="",f=b[0],d=f,g=f,h=b[1];c+=this.pathBasis(f,d,g,h);for(var i=2;i<b.length;i++){f=d;d=g;g=h;h=b[i];c+=this.pathBasis(f,d,g,h)}c+=this.pathBasis(d,g,h,h);c+=this.pathBasis(g,h,h,h);return c};
pv.SvgScene.curveBasisSegments=function(b){if(b.length<=2)return"";var c=[],f=b[0],d=f,g=f,h=b[1],i=this.pathBasis.segment(f,d,g,h);f=d;d=g;g=h;h=b[2];c.push(i+this.pathBasis(f,d,g,h));for(i=3;i<b.length;i++){f=d;d=g;g=h;h=b[i];c.push(this.pathBasis.segment(f,d,g,h))}c.push(this.pathBasis.segment(d,g,h,h)+this.pathBasis(g,h,h,h));return c};
pv.SvgScene.curveHermite=function(b,c){if(c.length<1||b.length!=c.length&&b.length!=c.length+2)return"";var f=b.length!=c.length,d="",g=b[0],h=b[1],i=c[0],j=i,l=1;if(f){d+="Q"+(h.left-i.x*2/3)+","+(h.top-i.y*2/3)+","+h.left+","+h.top;g=b[1];l=2}if(c.length>1){j=c[1];h=b[l];l++;d+="C"+(g.left+i.x)+","+(g.top+i.y)+","+(h.left-j.x)+","+(h.top-j.y)+","+h.left+","+h.top;for(g=2;g<c.length;g++,l++){h=b[l];j=c[g];d+="S"+(h.left-j.x)+","+(h.top-j.y)+","+h.left+","+h.top}}if(f){b=b[l];d+="Q"+(h.left+j.x*2/
3)+","+(h.top+j.y*2/3)+","+b.left+","+b.top}return d};
pv.SvgScene.curveHermiteSegments=function(b,c){if(c.length<1||b.length!=c.length&&b.length!=c.length+2)return[];var f=b.length!=c.length,d=[],g=b[0],h=g,i=c[0],j=i,l=1;if(f){h=b[1];d.push("M"+g.left+","+g.top+"Q"+(h.left-j.x*2/3)+","+(h.top-j.y*2/3)+","+h.left+","+h.top);l=2}for(var k=1;k<c.length;k++,l++){g=h;i=j;h=b[l];j=c[k];d.push("M"+g.left+","+g.top+"C"+(g.left+i.x)+","+(g.top+i.y)+","+(h.left-j.x)+","+(h.top-j.y)+","+h.left+","+h.top)}if(f){b=b[l];d.push("M"+h.left+","+h.top+"Q"+(h.left+j.x*
2/3)+","+(h.top+j.y*2/3)+","+b.left+","+b.top)}return d};pv.SvgScene.cardinalTangents=function(b,c){var f=[];c=(1-c)/2;for(var d=b[0],g=b[1],h=b[2],i=3;i<b.length;i++){f.push({x:c*(h.left-d.left),y:c*(h.top-d.top)});d=g;g=h;h=b[i]}f.push({x:c*(h.left-d.left),y:c*(h.top-d.top)});return f};pv.SvgScene.curveCardinal=function(b,c){if(b.length<=2)return"";return this.curveHermite(b,this.cardinalTangents(b,c))};
pv.SvgScene.curveCardinalSegments=function(b,c){if(b.length<=2)return"";return this.curveHermiteSegments(b,this.cardinalTangents(b,c))};
pv.SvgScene.monotoneTangents=function(b){var c=[],f=[],d=[],g=[],h=0;for(h=0;h<b.length-1;h++)f[h]=(b[h+1].top-b[h].top)/(b[h+1].left-b[h].left);d[0]=f[0];g[0]=b[1].left-b[0].left;for(h=1;h<b.length-1;h++){d[h]=(f[h-1]+f[h])/2;g[h]=(b[h+1].left-b[h-1].left)/2}d[h]=f[h-1];g[h]=b[h].left-b[h-1].left;for(h=0;h<b.length-1;h++)if(f[h]==0){d[h]=0;d[h+1]=0}for(h=0;h<b.length-1;h++)if(!(Math.abs(d[h])<1.0E-5||Math.abs(d[h+1])<1.0E-5)){var i=d[h]/f[h],j=d[h+1]/f[h],l=i*i+j*j;if(l>9){l=3/Math.sqrt(l);d[h]=
l*i*f[h];d[h+1]=l*j*f[h]}}for(h=0;h<b.length;h++){f=1+d[h]*d[h];c.push({x:g[h]/3/f,y:d[h]*g[h]/3/f})}return c};pv.SvgScene.curveMonotone=function(b){if(b.length<=2)return"";return this.curveHermite(b,this.monotoneTangents(b))};pv.SvgScene.curveMonotoneSegments=function(b){if(b.length<=2)return"";return this.curveHermiteSegments(b,this.monotoneTangents(b))};
pv.SvgScene.area=function(b){function c(n,p){for(var m=[],r=[],s=p;n<=s;n++,p--){var t=b[n],x=b[p];t=t.left+","+t.top;x=x.left+x.width+","+(x.top+x.height);if(n<s){var u=b[n+1],o=b[p-1];switch(g.interpolate){case "step-before":t+="V"+u.top;x+="H"+(o.left+o.width);break;case "step-after":t+="H"+u.left;x+="V"+(o.top+o.height);break}}m.push(t);r.push(x)}return m.concat(r).join("L")}function f(n,p){for(var m=[],r=[],s=p;n<=s;n++,p--){var t=b[p];m.push(b[n]);r.push({left:t.left+t.width,top:t.top+t.height})}if(g.interpolate==
"basis"){n=pv.SvgScene.curveBasis(m);p=pv.SvgScene.curveBasis(r)}else if(g.interpolate=="cardinal"){n=pv.SvgScene.curveCardinal(m,g.tension);p=pv.SvgScene.curveCardinal(r,g.tension)}else{n=pv.SvgScene.curveMonotone(m);p=pv.SvgScene.curveMonotone(r)}return m[0].left+","+m[0].top+n+"L"+r[0].left+","+r[0].top+p}var d=b.$g.firstChild;if(!b.length)return d;var g=b[0];if(g.segmented)return this.areaSegment(b);if(!g.visible)return d;var h=g.fillStyle,i=g.strokeStyle;if(!h.opacity&&!i.opacity)return d;for(var j=
[],l,k=0;k<b.length;k++){l=b[k];if(l.width||l.height){for(var q=k+1;q<b.length;q++){l=b[q];if(!l.width&&!l.height)break}k&&g.interpolate!="step-after"&&k--;q<b.length&&g.interpolate!="step-before"&&q++;j.push((q-k>2&&(g.interpolate=="basis"||g.interpolate=="cardinal"||g.interpolate=="monotone")?f:c)(k,q-1));k=q-1}}if(!j.length)return d;d=this.expect(d,"path",{"shape-rendering":g.antialias?null:"crispEdges","pointer-events":g.events,cursor:g.cursor,d:"M"+j.join("ZM")+"Z",fill:h.color,"fill-opacity":h.opacity||
null,stroke:i.color,"stroke-opacity":i.opacity||null,"stroke-width":i.opacity?g.lineWidth/this.scale:null,"class":g.classname||null});return this.append(d,b,0)};
pv.SvgScene.areaSegment=function(b){var c=b.$g.firstChild,f=b[0],d,g;if(f.interpolate=="basis"||f.interpolate=="cardinal"||f.interpolate=="monotone"){d=[];g=[];for(var h=0,i=b.length;h<i;h++){var j=b[i-h-1];d.push(b[h]);g.push({left:j.left+j.width,top:j.top+j.height})}if(f.interpolate=="basis"){d=this.curveBasisSegments(d);g=this.curveBasisSegments(g)}else if(f.interpolate=="cardinal"){d=this.curveCardinalSegments(d,f.tension);g=this.curveCardinalSegments(g,f.tension)}else{d=this.curveMonotoneSegments(d);
g=this.curveMonotoneSegments(g)}}h=0;for(i=b.length-1;h<i;h++){var l=b[h],k=b[h+1];if(l.visible&&k.visible){var q=l.fillStyle,n=l.strokeStyle;if(q.opacity||n.opacity){if(d){j=d[h];k="L"+g[i-h-1].substr(1);j=j+k+"Z"}else{var p=l;j=k;switch(l.interpolate){case "step-before":p=k;break;case "step-after":j=l;break}j="M"+l.left+","+p.top+"L"+k.left+","+j.top+"L"+(k.left+k.width)+","+(j.top+j.height)+"L"+(l.left+l.width)+","+(p.top+p.height)+"Z"}c=this.expect(c,"path",{"shape-rendering":l.antialias?null:
"crispEdges","pointer-events":l.events,cursor:l.cursor,d:j,fill:q.color,"fill-opacity":q.opacity||null,stroke:n.color,"stroke-opacity":n.opacity||null,"stroke-width":n.opacity?l.lineWidth/this.scale:null,"class":f.classname||null});c=this.append(c,b,h)}}}return c};
pv.SvgScene.bar=function(b){for(var c=b.$g.firstChild,f=0;f<b.length;f++){var d=b[f];if(d.visible){var g=d.fillStyle,h=d.strokeStyle;if(g.opacity||h.opacity){c=this.expect(c,"rect",{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,x:d.left,y:d.top,width:Math.max(1.0E-10,d.width),height:Math.max(1.0E-10,d.height),fill:g.color,"fill-opacity":g.opacity||null,stroke:h.color,"stroke-opacity":h.opacity||null,"stroke-width":h.opacity?d.lineWidth/this.scale:null,"class":d.classname||
null});c=this.append(c,b,f)}}}return c};
pv.SvgScene.dot=function(b){for(var c=b.$g.firstChild,f=0;f<b.length;f++){var d=b[f];if(d.visible){var g=d.fillStyle,h=d.strokeStyle;if(g.opacity||h.opacity){var i=d.radius,j=null;switch(d.shape){case "cross":j="M"+-i+","+-i+"L"+i+","+i+"M"+i+","+-i+"L"+-i+","+i;break;case "triangle":j=i;var l=i*1.1547;j="M0,"+j+"L"+l+","+-j+" "+-l+","+-j+"Z";break;case "diamond":i*=Math.SQRT2;j="M0,"+-i+"L"+i+",0 0,"+i+" "+-i+",0Z";break;case "square":j="M"+-i+","+-i+"L"+i+","+-i+" "+i+","+i+" "+-i+","+i+"Z";break;
case "tick":j="M0,0L0,"+-d.size;break;case "bar":j="M0,"+d.size/2+"L0,"+-(d.size/2);break}g={"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,fill:g.color,"fill-opacity":g.opacity||null,stroke:h.color,"stroke-opacity":h.opacity||null,"stroke-width":h.opacity?d.lineWidth/this.scale:null,"class":d.classname||null};if(j){g.transform="translate("+d.left+","+d.top+")";if(d.angle)g.transform+=" rotate("+180*d.angle/Math.PI+")";g.d=j;c=this.expect(c,"path",g)}else{g.cx=
d.left;g.cy=d.top;g.r=i;c=this.expect(c,"circle",g)}c=this.append(c,b,f)}}}return c};
pv.SvgScene.image=function(b){for(var c=b.$g.firstChild,f=0;f<b.length;f++){var d=b[f];if(d.visible){c=this.fill(c,b,f);if(d.image){c=this.expect(c,"foreignObject",{cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height,"class":d.classname||null});var g=c.firstChild||c.appendChild(document.createElementNS(this.xhtml,"canvas"));g.$scene={scenes:b,index:f};g.style.width=d.width;g.style.height=d.height;g.width=d.imageWidth;g.height=d.imageHeight;g.getContext("2d").putImageData(d.image,0,0)}else{c=
this.expect(c,"image",{preserveAspectRatio:"none",cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height,"class":d.classname||null});c.setAttributeNS(this.xlink,"href",d.url)}c=this.append(c,b,f);c=this.stroke(c,b,f)}}return c};
pv.SvgScene.label=function(b){for(var c=b.$g.firstChild,f=0;f<b.length;f++){var d=b[f];if(d.visible){var g=d.textStyle;if(g.opacity&&d.text){var h=0,i=0,j=0,l="start";switch(d.textBaseline){case "middle":j=".35em";break;case "top":j=".71em";i=d.textMargin;break;case "bottom":i="-"+d.textMargin;break}switch(d.textAlign){case "right":l="end";h="-"+d.textMargin;break;case "center":l="middle";break;case "left":h=d.textMargin;break}c=this.expect(c,"text",{"pointer-events":d.events,cursor:d.cursor,x:h,
y:i,dy:j,transform:"translate("+d.left+","+d.top+")"+(d.textAngle?" rotate("+180*d.textAngle/Math.PI+")":"")+(this.scale!=1?" scale("+1/this.scale+")":""),fill:g.color,"fill-opacity":g.opacity||null,"text-anchor":l,"class":d.classname||null},{font:d.font,"text-shadow":d.textShadow,"text-decoration":d.textDecoration});if(c.firstChild)c.firstChild.nodeValue=d.text;else c.appendChild(document.createTextNode(d.text));c=this.append(c,b,f)}}}return c};
pv.SvgScene.line=function(b){var c=b.$g.firstChild;if(b.length<2)return c;var f=b[0];if(f.segmented)return this.lineSegment(b);if(!f.visible)return c;var d=f.fillStyle,g=f.strokeStyle;if(!d.opacity&&!g.opacity)return c;var h="M"+f.left+","+f.top;if(b.length>2&&(f.interpolate=="basis"||f.interpolate=="cardinal"||f.interpolate=="monotone"))switch(f.interpolate){case "basis":h+=this.curveBasis(b);break;case "cardinal":h+=this.curveCardinal(b,f.tension);break;case "monotone":h+=this.curveMonotone(b);
break}else for(var i=1;i<b.length;i++)h+=this.pathSegment(b[i-1],b[i]);c=this.expect(c,"path",{"shape-rendering":f.antialias?null:"crispEdges","pointer-events":f.events,cursor:f.cursor,d:h,fill:d.color,"fill-opacity":d.opacity||null,stroke:g.color,"stroke-opacity":g.opacity||null,"stroke-width":g.opacity?f.lineWidth/this.scale:null,"stroke-linejoin":f.lineJoin,"class":f.classname||null});return this.append(c,b,0)};
pv.SvgScene.lineSegment=function(b){var c=b.$g.firstChild,f=b[0],d;switch(f.interpolate){case "basis":d=this.curveBasisSegments(b);break;case "cardinal":d=this.curveCardinalSegments(b,f.tension);break;case "monotone":d=this.curveMonotoneSegments(b);break}for(var g=0,h=b.length-1;g<h;g++){var i=b[g],j=b[g+1];if(i.visible&&j.visible){var l=i.strokeStyle,k=pv.Color.transparent;if(l.opacity){if(i.interpolate=="linear"&&i.lineJoin=="miter"){k=l;l=pv.Color.transparent;j=this.pathJoin(b[g-1],i,j,b[g+2])}else j=
d?d[g]:"M"+i.left+","+i.top+this.pathSegment(i,j);c=this.expect(c,"path",{"shape-rendering":i.antialias?null:"crispEdges","pointer-events":i.events,cursor:i.cursor,d:j,fill:k.color,"fill-opacity":k.opacity||null,stroke:l.color,"stroke-opacity":l.opacity||null,"stroke-width":l.opacity?i.lineWidth/this.scale:null,"stroke-linejoin":i.lineJoin,"class":f.classname||null});c=this.append(c,b,g)}}}return c};
pv.SvgScene.pathSegment=function(b,c){var f=1;switch(b.interpolate){case "polar-reverse":f=0;case "polar":var d=c.left-b.left,g=c.top-b.top;b=1-b.eccentricity;d=Math.sqrt(d*d+g*g)/(2*b);if(b<=0||b>1)break;return"A"+d+","+d+" 0 0,"+f+" "+c.left+","+c.top;case "step-before":return"V"+c.top+"H"+c.left;case "step-after":return"H"+c.left+"V"+c.top}return"L"+c.left+","+c.top};pv.SvgScene.lineIntersect=function(b,c,f,d){return b.plus(c.times(f.minus(b).dot(d.perp())/c.dot(d.perp())))};
pv.SvgScene.pathJoin=function(b,c,f,d){var g=pv.vector(c.left,c.top);f=pv.vector(f.left,f.top);var h=f.minus(g),i=h.perp().norm(),j=i.times(c.lineWidth/(2*this.scale));c=g.plus(j);var l=f.plus(j),k=f.minus(j);j=g.minus(j);if(b&&b.visible){b=g.minus(b.left,b.top).perp().norm().plus(i);j=this.lineIntersect(g,b,j,h);c=this.lineIntersect(g,b,c,h)}if(d&&d.visible){d=pv.vector(d.left,d.top).minus(f).perp().norm().plus(i);k=this.lineIntersect(f,d,k,h);l=this.lineIntersect(f,d,l,h)}return"M"+c.x+","+c.y+
"L"+l.x+","+l.y+" "+k.x+","+k.y+" "+j.x+","+j.y};
pv.SvgScene.panel=function(b){for(var c=b.$g,f=c&&c.firstChild,d=0;d<b.length;d++){var g=b[d];if(g.visible){if(!b.parent){g.canvas.style.display="inline-block";if(c&&c.parentNode!=g.canvas)f=(c=g.canvas.firstChild)&&c.firstChild;if(!c){c=g.canvas.appendChild(this.create("svg"));c.setAttribute("font-size","10px");c.setAttribute("font-family","sans-serif");c.setAttribute("fill","none");c.setAttribute("stroke","none");c.setAttribute("stroke-width",1.5);for(var h=0;h<this.events.length;h++)c.addEventListener(this.events[h],
this.dispatch,false);f=c.firstChild}b.$g=c;c.setAttribute("width",g.width+g.left+g.right);c.setAttribute("height",g.height+g.top+g.bottom)}if(g.overflow=="hidden"){h=pv.id().toString(36);var i=this.expect(f,"g",{"clip-path":"url(#"+h+")","class":g.classname||null});i.parentNode||c.appendChild(i);b.$g=c=i;f=i.firstChild;f=this.expect(f,"clipPath",{id:h});h=f.firstChild||f.appendChild(this.create("rect"));h.setAttribute("x",g.left);h.setAttribute("y",g.top);h.setAttribute("width",g.width);h.setAttribute("height",
g.height);h.setAttribute("class",g.classname||null);f.parentNode||c.appendChild(f);f=f.nextSibling}f=this.fill(f,b,d);var j=this.scale,l=g.transform,k=g.left+l.x,q=g.top+l.y;this.scale*=l.k;for(h=0;h<g.children.length;h++){g.children[h].$g=f=this.expect(f,"g",{transform:"translate("+k+","+q+")"+(l.k!=1?" scale("+l.k+")":""),"class":g.classname||null});this.updateAll(g.children[h]);f.parentNode||c.appendChild(f);f=f.nextSibling}this.scale=j;f=this.stroke(f,b,d);if(g.overflow=="hidden"){b.$g=c=i.parentNode;
f=i.nextSibling}}}return f};pv.SvgScene.fill=function(b,c,f){var d=c[f],g=d.fillStyle;if(g.opacity||d.events=="all"){b=this.expect(b,"rect",{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height,fill:g.color,"fill-opacity":g.opacity,stroke:null,"class":d.classname||null});b=this.append(b,c,f)}return b};
pv.SvgScene.stroke=function(b,c,f){var d=c[f],g=d.strokeStyle;if(g.opacity||d.events=="all"){b=this.expect(b,"rect",{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events=="all"?"stroke":d.events,cursor:d.cursor,x:d.left,y:d.top,width:Math.max(1.0E-10,d.width),height:Math.max(1.0E-10,d.height),fill:null,stroke:g.color,"stroke-opacity":g.opacity,"stroke-width":d.lineWidth/this.scale,"class":d.classname||null});b=this.append(b,c,f)}return b};
pv.SvgScene.rule=function(b){for(var c=b.$g.firstChild,f=0;f<b.length;f++){var d=b[f];if(d.visible){var g=d.strokeStyle;if(g.opacity){c=this.expect(c,"line",{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,x1:d.left,y1:d.top,x2:d.left+d.width,y2:d.top+d.height,stroke:g.color,"stroke-opacity":g.opacity,"stroke-width":d.lineWidth/this.scale,"class":d.classname||null});c=this.append(c,b,f)}}}return c};
pv.SvgScene.wedge=function(b){for(var c=b.$g.firstChild,f=0;f<b.length;f++){var d=b[f];if(d.visible){var g=d.fillStyle,h=d.strokeStyle;if(g.opacity||h.opacity){var i=d.innerRadius,j=d.outerRadius,l=Math.abs(d.angle);if(l>=2*Math.PI)i=i?"M0,"+j+"A"+j+","+j+" 0 1,1 0,"+-j+"A"+j+","+j+" 0 1,1 0,"+j+"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"Z":"M0,"+j+"A"+j+","+j+" 0 1,1 0,"+-j+"A"+j+","+j+" 0 1,1 0,"+j+"Z";else{var k=Math.min(d.startAngle,d.endAngle),q=Math.max(d.startAngle,d.endAngle),
n=Math.cos(k),p=Math.cos(q);k=Math.sin(k);q=Math.sin(q);i=i?"M"+j*n+","+j*k+"A"+j+","+j+" 0 "+(l<Math.PI?"0":"1")+",1 "+j*p+","+j*q+"L"+i*p+","+i*q+"A"+i+","+i+" 0 "+(l<Math.PI?"0":"1")+",0 "+i*n+","+i*k+"Z":"M"+j*n+","+j*k+"A"+j+","+j+" 0 "+(l<Math.PI?"0":"1")+",1 "+j*p+","+j*q+"L0,0Z"}c=this.expect(c,"path",{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,transform:"translate("+d.left+","+d.top+")",d:i,fill:g.color,"fill-rule":"evenodd","fill-opacity":g.opacity||
null,stroke:h.color,"stroke-opacity":h.opacity||null,"stroke-width":h.opacity?d.lineWidth/this.scale:null,"class":d.classname||null});c=this.append(c,b,f)}}}return c};pv.Mark=function(){this.$properties=[];this.$handlers={}};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(b,c){if(!this.hasOwnProperty("properties"))this.properties=pv.extend(this.properties);this.properties[b]=true;pv.Mark.prototype.propertyMethod(b,false,pv.Mark.cast[b]=c);return this};
pv.Mark.prototype.propertyMethod=function(b,c,f){f||(f=pv.Mark.cast[b]);this[b]=function(d){if(c&&this.scene){var g=this.scene.defs;if(arguments.length){g[b]={id:d==null?0:pv.id(),value:d!=null&&f?f(d):d};return this}return g[b]?g[b].value:null}if(arguments.length){g=!c<<1|typeof d=="function";this.propertyValue(b,g&1&&f?function(){var h=d.apply(this,arguments);return h!=null?f(h):null}:d!=null&&f?f(d):d).type=g;return this}return this.instance()[b]}};
pv.Mark.prototype.propertyValue=function(b,c){var f=this.$properties;c={name:b,id:pv.id(),value:c};for(var d=0;d<f.length;d++)if(f[d].name==b){f.splice(d,1);break}f.push(c);return c};pv.Mark.prototype.property("data").property("visible",Boolean).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String).property("classname",String);
a=pv.Mark.prototype;a.childIndex=-1;a.index=-1;a.scale=1;a.defaults=(new pv.Mark).data(function(b){return[b]}).visible(true).antialias(true).events("painted");a.extend=function(b){this.proto=b;this.target=b.target;return this};a.add=function(b){return this.parent.add(b).extend(this)};a.def=function(b,c){this.propertyMethod(b,true);return this[b](arguments.length>1?c:null)};
a.anchor=function(b){b||(b="center");return(new pv.Anchor(this)).name(b).data(function(){return this.scene.target.map(function(c){return c.data})}).visible(function(){return this.scene.target[this.index].visible}).left(function(){var c=this.scene.target[this.index],f=c.width||0;switch(this.name()){case "bottom":case "top":case "center":return c.left+f/2;case "left":return null}return c.left+f}).top(function(){var c=this.scene.target[this.index],f=c.height||0;switch(this.name()){case "left":case "right":case "center":return c.top+
f/2;case "top":return null}return c.top+f}).right(function(){var c=this.scene.target[this.index];return this.name()=="left"?c.right+(c.width||0):null}).bottom(function(){var c=this.scene.target[this.index];return this.name()=="top"?c.bottom+(c.height||0):null}).textAlign(function(){switch(this.name()){case "bottom":case "top":case "center":return"center";case "right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";case "top":return"top"}return"bottom"})};
a.anchorTarget=function(){return this.target};a.margin=function(b){return this.left(b).right(b).top(b).bottom(b)};a.instance=function(b){var c=this.scene||this.parent.instance(-1).children[this.childIndex],f=!arguments.length||this.hasOwnProperty("index")?this.index:b;return c[f<0?c.length-1:f]};
a.instances=function(b){for(var c=this,f=[],d;!(d=c.scene);){b=b.parent;f.push({index:b.index,childIndex:c.childIndex});c=c.parent}for(;f.length;){b=f.pop();d=d[b.index].children[b.childIndex]}if(this.hasOwnProperty("index")){f=pv.extend(d[this.index]);f.right=f.top=f.left=f.bottom=0;return[f]}return d};a.first=function(){return this.scene[0]};a.last=function(){return this.scene[this.scene.length-1]};a.sibling=function(){return this.index==0?null:this.scene[this.index-1]};
a.cousin=function(){var b=this.parent;return(b=b&&b.sibling())&&b.children?b.children[this.childIndex][this.index]:null};
a.render=function(){function b(i,j,l){i.scale=l;if(j<g.length){d.unshift(null);if(i.hasOwnProperty("index"))c(i,j,l);else{for(var k=0,q=i.scene.length;k<q;k++){i.index=k;c(i,j,l)}delete i.index}d.shift()}else{i.build();pv.Scene.scale=l;pv.Scene.updateAll(i.scene)}delete i.scale}function c(i,j,l){var k=i.scene[i.index],q;if(k.visible){var n=g[j],p=i.children[n];for(q=0;q<n;q++)i.children[q].scene=k.children[q];d[0]=k.data;if(p.scene)b(p,j+1,l*k.transform.k);else{p.scene=k.children[n];b(p,j+1,l*k.transform.k);
delete p.scene}for(q=0;q<n;q++)delete i.children[q].scene}}var f=this.parent,d=pv.Mark.stack;if(f&&!this.root.scene)this.root.render();else{for(var g=[],h=this;h.parent;h=h.parent)g.unshift(h.childIndex);for(this.bind();f&&!f.hasOwnProperty("index");)f=f.parent;this.context(f?f.scene:undefined,f?f.index:-1,function(){b(this.root,0,1)})}};pv.Mark.stack=[];a=pv.Mark.prototype;
a.bind=function(){function b(j){do for(var l=j.$properties,k=l.length-1;k>=0;k--){var q=l[k];if(!(q.name in c)){c[q.name]=q;switch(q.name){case "data":d=q;break;case "visible":g=q;break;default:f[q.type].push(q);break}}}while(j=j.proto)}var c={},f=[[],[],[],[]],d,g;b(this);b(this.defaults);f[1].reverse();f[3].reverse();var h=this;do for(var i in h.properties)i in c||f[2].push(c[i]={name:i,type:2,value:null});while(h=h.proto);h=f[0].concat(f[1]);for(i=0;i<h.length;i++)this.propertyMethod(h[i].name,
true);this.binds={properties:c,data:d,defs:h,required:[g],optional:pv.blend(f)}};
a.build=function(){var b=this.scene,c=pv.Mark.stack;if(!b){b=this.scene=[];b.mark=this;b.type=this.type;b.childIndex=this.childIndex;if(this.parent){b.parent=this.parent.scene;b.parentIndex=this.parent.index}}if(this.target)b.target=this.target.instances(b);if(this.binds.defs.length){var f=b.defs;if(!f)b.defs=f={};for(var d=0;d<this.binds.defs.length;d++){var g=this.binds.defs[d],h=f[g.name];if(!h||g.id>h.id)f[g.name]={id:0,value:g.type&1?g.value.apply(this,c):g.value}}}f=this.binds.data;f=f.type&
1?f.value.apply(this,c):f.value;c.unshift(null);b.length=f.length;for(d=0;d<f.length;d++){pv.Mark.prototype.index=this.index=d;(g=b[d])||(b[d]=g={});g.data=c[0]=f[d];this.buildInstance(g)}pv.Mark.prototype.index=-1;delete this.index;c.shift();return this};a.buildProperties=function(b,c){for(var f=0,d=c.length;f<d;f++){var g=c[f],h=g.value;switch(g.type){case 0:case 1:h=this.scene.defs[g.name].value;break;case 3:h=h.apply(this,pv.Mark.stack);break}b[g.name]=h}};
a.buildInstance=function(b){this.buildProperties(b,this.binds.required);if(b.visible){this.buildProperties(b,this.binds.optional);this.buildImplied(b)}};
a.buildImplied=function(b){var c=b.left,f=b.right,d=b.top,g=b.bottom,h=this.properties,i=h.width?b.width:0,j=h.height?b.height:0,l=this.parent?this.parent.width():i+c+f;if(i==null)i=l-(f=f||0)-(c=c||0);else if(f==null)if(c==null)c=f=(l-i)/2;else f=l-i-(c=c||0);else if(c==null)c=l-i-f;l=this.parent?this.parent.height():j+d+g;if(j==null)j=l-(d=d||0)-(g=g||0);else if(g==null)g=d==null?(d=(l-j)/2):l-j-(d=d||0);else if(d==null)d=l-j-g;b.left=c;b.right=f;b.top=d;b.bottom=g;if(h.width)b.width=i;if(h.height)b.height=
j;if(h.textStyle&&!b.textStyle)b.textStyle=pv.Color.transparent;if(h.fillStyle&&!b.fillStyle)b.fillStyle=pv.Color.transparent;if(h.strokeStyle&&!b.strokeStyle)b.strokeStyle=pv.Color.transparent};
a.mouse=function(){var b=pv.event.pageX||0,c=pv.event.pageY||0,f=this.root.canvas();do{b-=f.offsetLeft;c-=f.offsetTop}while(f=f.offsetParent);f=pv.Transform.identity;var d=this.properties.transform?this:this.parent,g=[];do g.push(d);while(d=d.parent);for(;d=g.pop();)f=f.translate(d.left(),d.top()).times(d.transform());f=f.invert();return pv.vector(b*f.k+f.x,c*f.k+f.y)};a.event=function(b,c){this.$handlers[b]=pv.functor(c);return this};
a.context=function(b,c,f){function d(k,q){pv.Mark.scene=k;h.index=q;if(k){var n=k.mark,p=n,m=[];do{m.push(p);i.push(k[q].data);p.index=q;p.scene=k;q=k.parentIndex;k=k.parent}while(p=p.parent);k=m.length-1;for(q=1;k>0;k--){p=m[k];p.scale=q;q*=p.scene[p.index].transform.k}if(n.children){k=0;for(m=n.children.length;k<m;k++){p=n.children[k];p.scene=n.scene[n.index].children[k];p.scale=q}}}}function g(k){if(k){k=k.mark;var q;if(k.children)for(var n=0,p=k.children.length;n<p;n++){q=k.children[n];delete q.scene;
delete q.scale}q=k;do{i.pop();if(q.parent){delete q.scene;delete q.scale}delete q.index}while(q=q.parent)}}var h=pv.Mark.prototype,i=pv.Mark.stack,j=pv.Mark.scene,l=h.index;g(j,l);d(b,c);try{f.apply(this,i)}finally{g(b,c);d(j,l)}};pv.Mark.dispatch=function(b,c,f){var d=c.mark,g=c.parent,h=d.$handlers[b];if(!h)return g&&pv.Mark.dispatch(b,g,c.parentIndex);d.context(c,f,function(){(d=h.apply(d,pv.Mark.stack))&&d.render&&d.render()});return true};
pv.Anchor=function(b){pv.Mark.call(this);this.target=b;this.parent=b.parent};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.extend=function(b){this.proto=b;return this};pv.Area=function(){pv.Mark.call(this)};
pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("tension",Number);pv.Area.prototype.type="area";pv.Area.prototype.defaults=(new pv.Area).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(0.7);
pv.Area.prototype.buildImplied=function(b){if(b.height==null)b.height=0;if(b.width==null)b.width=0;pv.Mark.prototype.buildImplied.call(this,b)};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeStyle:1,fillStyle:1,segmented:1,interpolate:1,tension:1};
pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var b=this.binds,c=b.required;b=b.optional;for(var f=0,d=b.length;f<d;f++){var g=b[f];g.fixed=g.name in pv.Area.fixed;if(g.name=="segmented"){c.push(g);b.splice(f,1);f--;d--}}this.binds.$required=c;this.binds.$optional=b};
pv.Area.prototype.buildInstance=function(b){var c=this.binds;if(this.index){var f=c.fixed;if(!f){f=c.fixed=[];function d(i){return!i.fixed||(f.push(i),false)}c.required=c.required.filter(d);if(!this.scene[0].segmented)c.optional=c.optional.filter(d)}c=0;for(var g=f.length;c<g;c++){var h=f[c].name;b[h]=this.scene[0][h]}}else{c.required=c.$required;c.optional=c.$optional;c.fixed=null}pv.Mark.prototype.buildInstance.call(this,b)};
pv.Area.prototype.anchor=function(b){return pv.Mark.prototype.anchor.call(this,b).interpolate(function(){return this.scene.target[this.index].interpolate}).eccentricity(function(){return this.scene.target[this.index].eccentricity}).tension(function(){return this.scene.target[this.index].tension})};pv.Bar=function(){pv.Mark.call(this)};
pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=(new pv.Bar).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent));pv.Dot=function(){pv.Mark.call(this)};
pv.Dot.prototype=pv.extend(pv.Mark).property("size",Number).property("radius",Number).property("shape",String).property("angle",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=(new pv.Dot).extend(pv.Mark.prototype.defaults).size(20).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent));
pv.Dot.prototype.anchor=function(b){return pv.Mark.prototype.anchor.call(this,b).left(function(){var c=this.scene.target[this.index];switch(this.name()){case "bottom":case "top":case "center":return c.left;case "left":return null}return c.left+c.radius}).right(function(){var c=this.scene.target[this.index];return this.name()=="left"?c.right+c.radius:null}).top(function(){var c=this.scene.target[this.index];switch(this.name()){case "left":case "right":case "center":return c.top;case "top":return null}return c.top+
c.radius}).bottom(function(){var c=this.scene.target[this.index];return this.name()=="top"?c.bottom+c.radius:null}).textAlign(function(){switch(this.name()){case "left":return"right";case "bottom":case "top":case "center":return"center"}return"left"}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";case "bottom":return"top"}return"bottom"})};
pv.Dot.prototype.buildImplied=function(b){if(b.radius==null)b.radius=Math.sqrt(b.size);else if(b.size==null)b.size=b.radius*b.radius;pv.Mark.prototype.buildImplied.call(this,b)};pv.Label=function(){pv.Mark.call(this)};
pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=(new pv.Label).extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);
pv.Line=function(){pv.Mark.call(this)};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("eccentricity",Number).property("tension",Number);a=pv.Line.prototype;a.type="line";a.defaults=(new pv.Line).extend(pv.Mark.prototype.defaults).lineJoin("miter").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear").eccentricity(0).tension(0.7);
a.bind=pv.Area.prototype.bind;a.buildInstance=pv.Area.prototype.buildInstance;a.anchor=function(b){return pv.Area.prototype.anchor.call(this,b).textAlign(function(){switch(this.name()){case "left":return"right";case "bottom":case "top":case "center":return"center";case "right":return"left"}}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";case "top":return"bottom";case "bottom":return"top"}})};pv.Rule=function(){pv.Mark.call(this)};
pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=(new pv.Rule).extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(false);pv.Rule.prototype.anchor=pv.Line.prototype.anchor;
pv.Rule.prototype.buildImplied=function(b){var c=b.left,f=b.right;if(b.width!=null||c==null&&f==null||f!=null&&c!=null)b.height=0;else b.width=0;pv.Mark.prototype.buildImplied.call(this,b)};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(b){return typeof b=="string"?document.getElementById(b):b});a=pv.Panel.prototype;a.type="panel";
a.defaults=(new pv.Panel).extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");a.anchor=function(b){b=pv.Bar.prototype.anchor.call(this,b);b.parent=this;return b};a.add=function(b){b=new b;b.parent=this;b.root=this.root;b.childIndex=this.children.length;this.children.push(b);return b};a.bind=function(){pv.Mark.prototype.bind.call(this);for(var b=0;b<this.children.length;b++)this.children[b].bind()};
a.buildInstance=function(b){pv.Bar.prototype.buildInstance.call(this,b);if(b.visible){if(!b.children)b.children=[];var c=this.scale*b.transform.k,f,d=this.children.length;pv.Mark.prototype.index=-1;for(var g=0;g<d;g++){f=this.children[g];f.scene=b.children[g];f.scale=c;f.build()}for(g=0;g<d;g++){f=this.children[g];b.children[g]=f.scene;delete f.scene;delete f.scale}b.children.length=d}};
a.buildImplied=function(b){if(!this.parent){var c=b.canvas;if(c){if(c.$panel!=this)for(c.$panel=this;c.lastChild;)c.removeChild(c.lastChild);var f;if(b.width==null){f=parseFloat(pv.css(c,"width"));b.width=f-b.left-b.right}if(b.height==null){f=parseFloat(pv.css(c,"height"));b.height=f-b.top-b.bottom}}else{f=this.$canvas||(this.$canvas=[]);if(!(c=f[this.index])){c=f[this.index]=document.createElement("span");if(this.$dom)this.$dom.parentNode.insertBefore(c,this.$dom);else{for(f=document.body;f.lastChild&&
f.lastChild.tagName;)f=f.lastChild;if(f!=document.body)f=f.parentNode;f.appendChild(c)}}}b.canvas=c}if(!b.transform)b.transform=pv.Transform.identity;pv.Mark.prototype.buildImplied.call(this,b)};pv.Image=function(){pv.Bar.call(this)};pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);a=pv.Image.prototype;a.type="image";a.defaults=(new pv.Image).extend(pv.Bar.prototype.defaults).fillStyle(null);
a.image=function(b){this.$image=function(){var c=b.apply(this,arguments);return c==null?pv.Color.transparent:typeof c=="string"?pv.color(c):c};return this};a.bind=function(){pv.Bar.prototype.bind.call(this);var b=this.binds,c=this;do b.image=c.$image;while(!b.image&&(c=c.proto))};
a.buildImplied=function(b){pv.Bar.prototype.buildImplied.call(this,b);if(b.visible){if(b.imageWidth==null)b.imageWidth=b.width;if(b.imageHeight==null)b.imageHeight=b.height;if(b.url==null&&this.binds.image){var c=this.$canvas||(this.$canvas=document.createElement("canvas")),f=c.getContext("2d"),d=b.imageWidth,g=b.imageHeight,h=pv.Mark.stack;c.width=d;c.height=g;b=(b.image=f.createImageData(d,g)).data;h.unshift(null,null);for(f=c=0;c<g;c++){h[1]=c;for(var i=0;i<d;i++){h[0]=i;var j=this.binds.image.apply(this,
h);b[f++]=j.r;b[f++]=j.g;b[f++]=j.b;b[f++]=255*j.a}}h.splice(0,2)}}};pv.Wedge=function(){pv.Mark.call(this)};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);a=pv.Wedge.prototype;a.type="wedge";
a.defaults=(new pv.Wedge).extend(pv.Mark.prototype.defaults).startAngle(function(){var b=this.sibling();return b?b.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index));a.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2};a.midAngle=function(){return(this.startAngle()+this.endAngle())/2};
a.anchor=function(b){function c(g){return g.innerRadius||g.angle<2*Math.PI}function f(g){return(g.innerRadius+g.outerRadius)/2}function d(g){return(g.startAngle+g.endAngle)/2}return pv.Mark.prototype.anchor.call(this,b).left(function(){var g=this.scene.target[this.index];if(c(g))switch(this.name()){case "outer":return g.left+g.outerRadius*Math.cos(d(g));case "inner":return g.left+g.innerRadius*Math.cos(d(g));case "start":return g.left+f(g)*Math.cos(g.startAngle);case "center":return g.left+f(g)*Math.cos(d(g));
case "end":return g.left+f(g)*Math.cos(g.endAngle)}return g.left}).top(function(){var g=this.scene.target[this.index];if(c(g))switch(this.name()){case "outer":return g.top+g.outerRadius*Math.sin(d(g));case "inner":return g.top+g.innerRadius*Math.sin(d(g));case "start":return g.top+f(g)*Math.sin(g.startAngle);case "center":return g.top+f(g)*Math.sin(d(g));case "end":return g.top+f(g)*Math.sin(g.endAngle)}return g.top}).textAlign(function(){var g=this.scene.target[this.index];if(c(g))switch(this.name()){case "outer":return pv.Wedge.upright(d(g))?
"right":"left";case "inner":return pv.Wedge.upright(d(g))?"left":"right"}return"center"}).textBaseline(function(){var g=this.scene.target[this.index];if(c(g))switch(this.name()){case "start":return pv.Wedge.upright(g.startAngle)?"top":"bottom";case "end":return pv.Wedge.upright(g.endAngle)?"bottom":"top"}return"middle"}).textAngle(function(){var g=this.scene.target[this.index],h=0;if(c(g))switch(this.name()){case "center":case "inner":case "outer":h=d(g);break;case "start":h=g.startAngle;break;case "end":h=
g.endAngle;break}return pv.Wedge.upright(h)?h:h+Math.PI})};pv.Wedge.upright=function(b){b%=2*Math.PI;b=b<0?2*Math.PI+b:b;return b<Math.PI/2||b>=3*Math.PI/2};pv.Wedge.prototype.buildImplied=function(b){if(b.angle==null)b.angle=b.endAngle-b.startAngle;else if(b.endAngle==null)b.endAngle=b.startAngle+b.angle;pv.Mark.prototype.buildImplied.call(this,b)};pv.simulation=function(b){return new pv.Simulation(b)};pv.Simulation=function(b){for(var c=0;c<b.length;c++)this.particle(b[c])};a=pv.Simulation.prototype;
a.particle=function(b){b.next=this.particles;if(isNaN(b.px))b.px=b.x;if(isNaN(b.py))b.py=b.y;if(isNaN(b.fx))b.fx=0;if(isNaN(b.fy))b.fy=0;this.particles=b;return this};a.force=function(b){b.next=this.forces;this.forces=b;return this};a.constraint=function(b){b.next=this.constraints;this.constraints=b;return this};
a.stabilize=function(b){var c;arguments.length||(b=3);for(var f=0;f<b;f++){var d=new pv.Quadtree(this.particles);for(c=this.constraints;c;c=c.next)c.apply(this.particles,d)}for(c=this.particles;c;c=c.next){c.px=c.x;c.py=c.y}return this};
a.step=function(){var b;for(b=this.particles;b;b=b.next){var c=b.px,f=b.py;b.px=b.x;b.py=b.y;b.x+=b.vx=b.x-c+b.fx;b.y+=b.vy=b.y-f+b.fy}c=new pv.Quadtree(this.particles);for(b=this.constraints;b;b=b.next)b.apply(this.particles,c);for(b=this.particles;b;b=b.next)b.fx=b.fy=0;for(b=this.forces;b;b=b.next)b.apply(this.particles,c)};
pv.Quadtree=function(b){function c(k,q,n,p,m,r){if(!(isNaN(q.x)||isNaN(q.y)))if(k.leaf)if(k.p){if(!(Math.abs(k.p.x-q.x)+Math.abs(k.p.y-q.y)<0.01)){var s=k.p;k.p=null;f(k,s,n,p,m,r)}f(k,q,n,p,m,r)}else k.p=q;else f(k,q,n,p,m,r)}function f(k,q,n,p,m,r){var s=(n+m)*0.5,t=(p+r)*0.5,x=q.x>=s,u=q.y>=t;k.leaf=false;switch((u<<1)+x){case 0:k=k.c1||(k.c1=new pv.Quadtree.Node);break;case 1:k=k.c2||(k.c2=new pv.Quadtree.Node);break;case 2:k=k.c3||(k.c3=new pv.Quadtree.Node);break;case 3:k=k.c4||(k.c4=new pv.Quadtree.Node);
break}if(x)n=s;else m=s;if(u)p=t;else r=t;c(k,q,n,p,m,r)}var d,g=Number.POSITIVE_INFINITY,h=g,i=Number.NEGATIVE_INFINITY,j=i;for(d=b;d;d=d.next){if(d.x<g)g=d.x;if(d.y<h)h=d.y;if(d.x>i)i=d.x;if(d.y>j)j=d.y}d=i-g;var l=j-h;if(d>l)j=h+d;else i=g+l;this.xMin=g;this.yMin=h;this.xMax=i;this.yMax=j;this.root=new pv.Quadtree.Node;for(d=b;d;d=d.next)c(this.root,d,g,h,i,j)};pv.Quadtree.Node=function(){this.leaf=true;this.p=this.c4=this.c3=this.c2=this.c1=null};pv.Force={};
pv.Force.charge=function(b){function c(k){function q(m){c(m);k.cn+=m.cn;n+=m.cn*m.cx;p+=m.cn*m.cy}var n=0,p=0;k.cn=0;if(!k.leaf){k.c1&&q(k.c1);k.c2&&q(k.c2);k.c3&&q(k.c3);k.c4&&q(k.c4)}if(k.p){k.cn+=b;n+=b*k.p.x;p+=b*k.p.y}k.cx=n/k.cn;k.cy=p/k.cn}function f(k,q,n,p,m,r){var s=k.cx-q.x,t=k.cy-q.y,x=1/Math.sqrt(s*s+t*t);if(k.leaf&&k.p!=q||(m-n)*x<j){if(!(x<i)){if(x>g)x=g;k=k.cn*x*x*x;s=s*k;t=t*k;q.fx+=s;q.fy+=t}}else if(!k.leaf){var u=(n+m)*0.5,o=(p+r)*0.5;k.c1&&f(k.c1,q,n,p,u,o);k.c2&&f(k.c2,q,u,p,
m,o);k.c3&&f(k.c3,q,n,o,u,r);k.c4&&f(k.c4,q,u,o,m,r);if(!(x<i)){if(x>g)x=g;if(k.p&&k.p!=q){k=b*x*x*x;s=s*k;t=t*k;q.fx+=s;q.fy+=t}}}}var d=2,g=1/d,h=500,i=1/h,j=0.9,l={};arguments.length||(b=-40);l.constant=function(k){if(arguments.length){b=Number(k);return l}return b};l.domain=function(k,q){if(arguments.length){d=Number(k);g=1/d;h=Number(q);i=1/h;return l}return[d,h]};l.theta=function(k){if(arguments.length){j=Number(k);return l}return j};l.apply=function(k,q){c(q.root);for(k=k;k;k=k.next)f(q.root,
k,q.xMin,q.yMin,q.xMax,q.yMax)};return l};pv.Force.drag=function(b){var c={};arguments.length||(b=0.1);c.constant=function(f){if(arguments.length){b=f;return c}return b};c.apply=function(f){if(b)for(f=f;f;f=f.next){f.fx-=b*f.vx;f.fy-=b*f.vy}};return c};
pv.Force.spring=function(b){var c=0.1,f=20,d,g,h={};arguments.length||(b=0.1);h.links=function(i){if(arguments.length){d=i;g=i.map(function(j){return 1/Math.sqrt(Math.max(j.sourceNode.linkDegree,j.targetNode.linkDegree))});return h}return d};h.constant=function(i){if(arguments.length){b=Number(i);return h}return b};h.damping=function(i){if(arguments.length){c=Number(i);return h}return c};h.length=function(i){if(arguments.length){f=Number(i);return h}return f};h.apply=function(){for(var i=0;i<d.length;i++){var j=
d[i].sourceNode,l=d[i].targetNode,k=j.x-l.x,q=j.y-l.y,n=Math.sqrt(k*k+q*q),p=n?1/n:1;p=(b*g[i]*(n-f)+c*g[i]*(k*(j.vx-l.vx)+q*(j.vy-l.vy))*p)*p;k=-p*(n?k:0.01*(0.5-Math.random()));q=-p*(n?q:0.01*(0.5-Math.random()));j.fx+=k;j.fy+=q;l.fx-=k;l.fy-=q}};return h};pv.Constraint={};
pv.Constraint.collision=function(b){function c(k,q,n,p,m,r){if(!k.leaf){var s=(n+m)*0.5,t=(p+r)*0.5,x=t<j,u=s>g,o=s<i;if(t>h){k.c1&&u&&c(k.c1,q,n,p,s,t);k.c2&&o&&c(k.c2,q,s,p,m,t)}if(x){k.c3&&u&&c(k.c3,q,n,t,s,r);k.c4&&o&&c(k.c4,q,s,t,m,r)}}if(k.p&&k.p!=q){n=q.x-k.p.x;p=q.y-k.p.y;m=Math.sqrt(n*n+p*p);r=d+b(k.p);if(m<r){m=(m-r)/m*0.5;n*=m;p*=m;q.x-=n;q.y-=p;k.p.x+=n;k.p.y+=p}}}var f=1,d,g,h,i,j,l={};arguments.length||(d=10);l.repeat=function(k){if(arguments.length){f=Number(k);return l}return f};l.apply=
function(k,q){var n,p,m=-Infinity;for(n=k;n;n=n.next){p=b(n);if(p>m)m=p}for(var r=0;r<f;r++)for(n=k;n;n=n.next){p=(d=b(n))+m;g=n.x-p;i=n.x+p;h=n.y-p;j=n.y+p;c(q.root,n,q.xMin,q.yMin,q.xMax,q.yMax)}};return l};pv.Constraint.position=function(b){var c=1,f={};arguments.length||(b=function(d){return d.fix});f.alpha=function(d){if(arguments.length){c=Number(d);return f}return c};f.apply=function(d){for(d=d;d;d=d.next){var g=b(d);if(g){d.x+=(g.x-d.x)*c;d.y+=(g.y-d.y)*c;d.fx=d.fy=d.vx=d.vy=0}}};return f};
pv.Constraint.bound=function(){var b={},c,f;b.x=function(d,g){if(arguments.length){c={min:Math.min(d,g),max:Math.max(d,g)};return this}return c};b.y=function(d,g){if(arguments.length){f={min:Math.min(d,g),max:Math.max(d,g)};return this}return f};b.apply=function(d){if(c)for(var g=d;g;g=g.next)g.x=g.x<c.min?c.min:g.x>c.max?c.max:g.x;if(f)for(g=d;g;g=g.next)g.y=g.y<f.min?f.min:g.y>f.max?f.max:g.y};return b};pv.Layout=function(){pv.Panel.call(this)};pv.Layout.prototype=pv.extend(pv.Panel);
pv.Layout.prototype.property=function(b,c){if(!this.hasOwnProperty("properties"))this.properties=pv.extend(this.properties);this.properties[b]=true;this.propertyMethod(b,false,pv.Mark.cast[b]=c);return this};
pv.Layout.Network=function(){pv.Layout.call(this);var b=this;this.$id=pv.id();(this.node=(new pv.Mark).data(function(){return b.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(c){return c.x}).top(function(c){return c.y})).parent=this;this.link=(new pv.Mark).extend(this.node).data(function(c){return[c.sourceNode,c.targetNode]}).fillStyle(null).lineWidth(function(c,f){return f.linkValue*1.5}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(c){return b.add(pv.Panel).data(function(){return b.links()}).add(c).extend(this)};
(this.label=(new pv.Mark).extend(this.node).textMargin(7).textBaseline("middle").text(function(c){return c.nodeName||c.nodeValue}).textAngle(function(c){c=c.midAngle;return pv.Wedge.upright(c)?c:c+Math.PI}).textAlign(function(c){return pv.Wedge.upright(c.midAngle)?"left":"right"})).parent=this};
pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(b){return b.map(function(c,f){if(typeof c!="object")c={nodeValue:c};c.index=f;return c})}).property("links",function(b){return b.map(function(c){if(isNaN(c.linkValue))c.linkValue=isNaN(c.value)?1:c.value;return c})});pv.Layout.Network.prototype.reset=function(){this.$id=pv.id();return this};pv.Layout.Network.prototype.buildProperties=function(b,c){if((b.$id||0)<this.$id)pv.Layout.prototype.buildProperties.call(this,b,c)};
pv.Layout.Network.prototype.buildImplied=function(b){pv.Layout.prototype.buildImplied.call(this,b);if(b.$id>=this.$id)return true;b.$id=this.$id;b.nodes.forEach(function(c){c.linkDegree=0});b.links.forEach(function(c){var f=c.linkValue;(c.sourceNode||(c.sourceNode=b.nodes[c.source])).linkDegree+=f;(c.targetNode||(c.targetNode=b.nodes[c.target])).linkDegree+=f})};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc")};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);
pv.Layout.Hierarchy.prototype.buildImplied=function(b){if(!b.links)b.links=pv.Layout.Hierarchy.links.call(this);pv.Layout.Network.prototype.buildImplied.call(this,b)};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(b){return b.parentNode}).map(function(b){return{sourceNode:b,targetNode:b.parentNode,linkValue:1}})};
pv.Layout.Hierarchy.NodeLink={buildImplied:function(b){function c(m){return m.parentNode?m.depth*(n-q)+q:0}function f(m){return m.parentNode?(m.breadth-0.25)*2*Math.PI:0}function d(m){switch(i){case "left":return m.depth*l;case "right":return l-m.depth*l;case "top":return m.breadth*l;case "bottom":return l-m.breadth*l;case "radial":return l/2+c(m)*Math.cos(m.midAngle)}}function g(m){switch(i){case "left":return m.breadth*k;case "right":return k-m.breadth*k;case "top":return m.depth*k;case "bottom":return k-
m.depth*k;case "radial":return k/2+c(m)*Math.sin(m.midAngle)}}var h=b.nodes,i=b.orient,j=/^(top|bottom)$/.test(i),l=b.width,k=b.height;if(i=="radial"){var q=b.innerRadius,n=b.outerRadius;if(q==null)q=0;if(n==null)n=Math.min(l,k)/2}for(b=0;b<h.length;b++){var p=h[b];p.midAngle=i=="radial"?f(p):j?Math.PI/2:0;p.x=d(p);p.y=g(p);if(p.firstChild)p.midAngle+=Math.PI}}};
pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(b){return b.dx}).height(function(b){return b.dy}).innerRadius(function(b){return b.innerRadius}).outerRadius(function(b){return b.outerRadius}).startAngle(function(b){return b.startAngle}).angle(function(b){return b.angle});this.label.textAlign("center").left(function(b){return b.x+b.dx/2}).top(function(b){return b.y+b.dy/2});delete this.link},buildImplied:function(b){function c(o,v){return(o+
v)/(1+v)}function f(o){switch(n){case "left":return c(o.minDepth,s)*m;case "right":return(1-c(o.maxDepth,s))*m;case "top":return o.minBreadth*m;case "bottom":return(1-o.maxBreadth)*m;case "radial":return m/2}}function d(o){switch(n){case "left":return o.minBreadth*r;case "right":return(1-o.maxBreadth)*r;case "top":return c(o.minDepth,s)*r;case "bottom":return(1-c(o.maxDepth,s))*r;case "radial":return r/2}}function g(o){switch(n){case "left":case "right":return(o.maxDepth-o.minDepth)/(1+s)*m;case "top":case "bottom":return(o.maxBreadth-
o.minBreadth)*m;case "radial":return o.parentNode?(o.innerRadius+o.outerRadius)*Math.cos(o.midAngle):0}}function h(o){switch(n){case "left":case "right":return(o.maxBreadth-o.minBreadth)*r;case "top":case "bottom":return(o.maxDepth-o.minDepth)/(1+s)*r;case "radial":return o.parentNode?(o.innerRadius+o.outerRadius)*Math.sin(o.midAngle):0}}function i(o){return Math.max(0,c(o.minDepth,s/2))*(x-t)+t}function j(o){return c(o.maxDepth,s/2)*(x-t)+t}function l(o){return(o.parentNode?o.minBreadth-0.25:0)*
2*Math.PI}function k(o){return(o.parentNode?o.maxBreadth-o.minBreadth:1)*2*Math.PI}var q=b.nodes,n=b.orient,p=/^(top|bottom)$/.test(n),m=b.width,r=b.height,s=-q[0].minDepth;if(n=="radial"){var t=b.innerRadius,x=b.outerRadius;if(t==null)t=0;if(t)s*=2;if(x==null)x=Math.min(m,r)/2}for(b=0;b<q.length;b++){var u=q[b];u.x=f(u);u.y=d(u);if(n=="radial"){u.innerRadius=i(u);u.outerRadius=j(u);u.startAngle=l(u);u.angle=k(u);u.midAngle=u.startAngle+u.angle/2}else u.midAngle=p?-Math.PI/2:0;u.dx=g(u);u.dy=h(u)}}};
pv.Layout.Grid=function(){pv.Layout.call(this);var b=this;(this.cell=(new pv.Mark).data(function(){return b.scene[b.index].$grid}).width(function(){return b.width()/b.cols()}).height(function(){return b.height()/b.rows()}).left(function(){return this.width()*(this.index%b.cols())}).top(function(){return this.height()*Math.floor(this.index/b.cols())})).parent=this};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols");pv.Layout.Grid.prototype.defaults=(new pv.Layout.Grid).extend(pv.Layout.prototype.defaults).rows(1).cols(1);
pv.Layout.Grid.prototype.buildImplied=function(b){pv.Layout.prototype.buildImplied.call(this,b);var c=b.rows,f=b.cols;if(typeof f=="object")c=pv.transpose(f);if(typeof c=="object"){b.$grid=pv.blend(c);b.rows=c.length;b.cols=c[0]?c[0].length:0}else b.$grid=pv.repeat([b.data],c*f)};
pv.Layout.Stack=function(){function b(i){return function(){return d[i](this.parent.index,this.index)}}pv.Layout.call(this);var c=this,f=function(){return null},d={t:f,l:f,r:f,b:f,w:f,h:f},g,h=c.buildImplied;this.buildImplied=function(i){h.call(this,i);var j=i.layers,l=j.length,k,q=i.orient,n=/^(top|bottom)\b/.test(q),p=this.parent[n?"height":"width"](),m=[],r=[],s=[],t=pv.Mark.stack,x={parent:{parent:this}};t.unshift(null);g=[];for(var u=0;u<l;u++){s[u]=[];r[u]=[];x.parent.index=u;t[0]=j[u];g[u]=
this.$values.apply(x.parent,t);if(!u)k=g[u].length;t.unshift(null);for(var o=0;o<k;o++){t[0]=g[u][o];x.index=o;u||(m[o]=this.$x.apply(x,t));s[u][o]=this.$y.apply(x,t)}t.shift()}t.shift();switch(i.order){case "inside-out":var v=s.map(function(A){return pv.max.index(A)});x=pv.range(l).sort(function(A,D){return v[A]-v[D]});j=s.map(function(A){return pv.sum(A)});var w=t=0,y=[],z=[];for(u=0;u<l;u++){o=x[u];if(t<w){t+=j[o];y.push(o)}else{w+=j[o];z.push(o)}}j=z.reverse().concat(y);break;case "reverse":j=
pv.range(l-1,-1,-1);break;default:j=pv.range(l);break}switch(i.offset){case "silohouette":for(o=0;o<k;o++){for(u=x=0;u<l;u++)x+=s[u][o];r[j[0]][o]=(p-x)/2}break;case "wiggle":for(u=x=0;u<l;u++)x+=s[u][0];r[j[0]][0]=x=(p-x)/2;for(o=1;o<k;o++){t=p=0;w=m[o]-m[o-1];for(u=0;u<l;u++)p+=s[u][o];for(u=0;u<l;u++){y=(s[j[u]][o]-s[j[u]][o-1])/(2*w);for(i=0;i<u;i++)y+=(s[j[i]][o]-s[j[i]][o-1])/w;t+=y*s[j[u]][o]}r[j[0]][o]=x-=p?t/p*w:0}break;case "expand":for(o=0;o<k;o++){for(u=i=r[j[0]][o]=0;u<l;u++)i+=s[u][o];
if(i){i=p/i;for(u=0;u<l;u++)s[u][o]*=i}else{i=p/l;for(u=0;u<l;u++)s[u][o]=i}}break;default:for(o=0;o<k;o++)r[j[0]][o]=0;break}for(o=0;o<k;o++){x=r[j[0]][o];for(u=1;u<l;u++){x+=s[j[u-1]][o];r[j[u]][o]=x}}u=q.indexOf("-");l=n?"h":"w";n=u<0?n?"l":"b":q.charAt(u+1);q=q.charAt(0);for(var C in d)d[C]=f;d[n]=function(A,D){return m[D]};d[q]=function(A,D){return r[A][D]};d[l]=function(A,D){return s[A][D]}};this.layer=(new pv.Mark).data(function(){return g[this.parent.index]}).top(b("t")).left(b("l")).right(b("r")).bottom(b("b")).width(b("w")).height(b("h"));
this.layer.add=function(i){return c.add(pv.Panel).data(function(){return c.layers()}).add(i).extend(this)}};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers");a=pv.Layout.Stack.prototype;a.defaults=(new pv.Layout.Stack).extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]);a.$x=pv.Layout.Stack.prototype.$y=function(){return 0};a.x=function(b){this.$x=pv.functor(b);return this};
a.y=function(b){this.$y=pv.functor(b);return this};a.$values=pv.identity;a.values=function(b){this.$values=pv.functor(b);return this};
pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(b){return b.dx}).height(function(b){return b.dy});this.label.visible(function(b){return!b.firstChild}).left(function(b){return b.x+b.dx/2}).top(function(b){return b.y+b.dy/2}).textAlign("center").textAngle(function(b){return b.dx>b.dy?0:-Math.PI/2});(this.leaf=(new pv.Mark).extend(this.node).fillStyle(null).strokeStyle(null).visible(function(b){return!b.firstChild})).parent=
this;delete this.link};pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("paddingLeft",Number).property("paddingRight",Number).property("paddingTop",Number).property("paddingBottom",Number).property("mode",String).property("order",String);a=pv.Layout.Treemap.prototype;a.defaults=(new pv.Layout.Treemap).extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");a.padding=function(b){return this.paddingLeft(b).paddingRight(b).paddingTop(b).paddingBottom(b)};
a.$size=function(b){return Number(b.nodeValue)};a.size=function(b){this.$size=pv.functor(b);return this};
a.buildImplied=function(b){function c(r,s,t,x,u,o,v){for(var w=0,y=0;w<r.length;w++){var z=r[w];if(t){z.x=x+y;z.y=u;y+=z.dx=p(o*z.size/s);z.dy=v}else{z.x=x;z.y=u+y;z.dx=o;y+=z.dy=p(v*z.size/s)}}if(z)if(t)z.dx+=o-y;else z.dy+=v-y}function f(r,s){for(var t=-Infinity,x=Infinity,u=0,o=0;o<r.length;o++){var v=r[o].size;if(v<x)x=v;if(v>t)t=v;u+=v}u*=u;s*=s;return Math.max(s*t/u,u/(s*x))}function d(r,s){function t(A){var D=o==y,G=pv.sum(A,n),E=y?p(G/y):0;c(A,G,D,x,u,D?o:E,D?E:v);if(D){u+=E;v-=E}else{x+=
E;o-=E}y=Math.min(o,v);return D}var x=r.x+j,u=r.y+k,o=r.dx-j-l,v=r.dy-k-q;if(m!="squarify")c(r.childNodes,r.size,m=="slice"?true:m=="dice"?false:s&1,x,u,o,v);else{var w=[];s=Infinity;var y=Math.min(o,v),z=o*v/r.size;if(!(r.size<=0)){r.visitBefore(function(A){A.size*=z});for(r=r.childNodes.slice();r.length;){var C=r[r.length-1];if(C.size){w.push(C);z=f(w,y);if(z<=s){r.pop();s=z}else{w.pop();t(w);w.length=0;s=Infinity}}else r.pop()}if(t(w))for(s=0;s<w.length;s++)w[s].dy+=v;else for(s=0;s<w.length;s++)w[s].dx+=
o}}}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,b)){var g=this,h=b.nodes[0],i=pv.Mark.stack,j=b.paddingLeft,l=b.paddingRight,k=b.paddingTop,q=b.paddingBottom,n=function(r){return r.size},p=b.round?Math.round:Number,m=b.mode;i.unshift(null);h.visitAfter(function(r,s){r.depth=s;r.x=r.y=r.dx=r.dy=0;r.size=r.firstChild?pv.sum(r.childNodes,function(t){return t.size}):g.$size.apply(g,(i[0]=r,i))});i.shift();switch(b.order){case "ascending":h.sort(function(r,s){return r.size-s.size});break;
case "descending":h.sort(function(r,s){return s.size-r.size});break;case "reverse":h.reverse();break}h.x=0;h.y=0;h.dx=b.width;h.dy=b.height;h.visitBefore(d)}};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=(new pv.Layout.Tree).extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");
pv.Layout.Tree.prototype.buildImplied=function(b){function c(o){var v,w,y;if(o.firstChild){v=o.firstChild;w=o.lastChild;for(var z=y=v;z;z=z.nextSibling){c(z);y=d(z,y)}j(o);w=0.5*(v.prelim+w.prelim);if(v=o.previousSibling){o.prelim=v.prelim+k(o.depth,true);o.mod=o.prelim-w}else o.prelim=w}else if(v=o.previousSibling)o.prelim=v.prelim+k(o.depth,true)}function f(o,v,w){o.breadth=o.prelim+v;v+=o.mod;for(o=o.firstChild;o;o=o.nextSibling)f(o,v,w)}function d(o,v){var w=o.previousSibling;if(w){var y=o,z=
o,C=w;w=o.parentNode.firstChild;var A=y.mod,D=z.mod,G=C.mod,E=w.mod;C=h(C);for(y=g(y);C&&y;){C=C;y=y;w=g(w);z=h(z);z.ancestor=o;var B=C.prelim+G-(y.prelim+A)+k(C.depth,false);if(B>0){i(l(C,o,v),o,B);A+=B;D+=B}G+=C.mod;A+=y.mod;E+=w.mod;D+=z.mod;C=h(C);y=g(y)}if(C&&!h(z)){z.thread=C;z.mod+=G-D}if(y&&!g(w)){w.thread=y;w.mod+=A-E;v=o}}return v}function g(o){return o.firstChild||o.thread}function h(o){return o.lastChild||o.thread}function i(o,v,w){var y=v.number-o.number;v.change-=w/y;v.shift+=w;o.change+=
w/y;v.prelim+=w;v.mod+=w}function j(o){var v=0,w=0;for(o=o.lastChild;o;o=o.previousSibling){o.prelim+=v;o.mod+=v;w+=o.change;v+=o.shift+w}}function l(o,v,w){return o.ancestor.parentNode==v.parentNode?o.ancestor:w}function k(o,v){return(v?1:t+1)/(m=="radial"?o:1)}function q(o){return m=="radial"?o.breadth/r:0}function n(o){switch(m){case "left":return o.depth;case "right":return x-o.depth;case "top":case "bottom":return o.breadth+x/2;case "radial":return x/2+o.depth*Math.cos(q(o))}}function p(o){switch(m){case "left":case "right":return o.breadth+
u/2;case "top":return o.depth;case "bottom":return u-o.depth;case "radial":return u/2+o.depth*Math.sin(q(o))}}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,b)){var m=b.orient,r=b.depth,s=b.breadth,t=b.group,x=b.width,u=b.height;b=b.nodes[0];b.visitAfter(function(o,v){o.ancestor=o;o.prelim=0;o.mod=0;o.change=0;o.shift=0;o.number=o.previousSibling?o.previousSibling.number+1:0;o.depth=v});c(b);f(b,-b.prelim,0);b.visitAfter(function(o){o.breadth*=s;o.depth*=r;o.midAngle=q(o);o.x=n(o);o.y=p(o);
if(o.firstChild)o.midAngle+=Math.PI;delete o.breadth;delete o.depth;delete o.ancestor;delete o.prelim;delete o.mod;delete o.change;delete o.shift;delete o.number;delete o.thread})}};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after")};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=(new pv.Layout.Indent).extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);
pv.Layout.Indent.prototype.buildImplied=function(b){function c(i,j,l){i.x=g+l++*d;i.y=h+j++*f;i.midAngle=0;for(i=i.firstChild;i;i=i.nextSibling)j=c(i,j,l);return j}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,b)){var f=b.breadth,d=b.depth,g=0,h=0;c(b.nodes[0],1,1)}};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);this.node.radius(function(b){return b.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.label.textAlign("center");delete this.link};
pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=(new pv.Layout.Pack).extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");pv.Layout.Pack.prototype.$radius=function(){return 1};pv.Layout.Pack.prototype.size=function(b){this.$radius=typeof b=="function"?function(){return Math.sqrt(b.apply(this,arguments))}:(b=Math.sqrt(b),function(){return b});return this};
pv.Layout.Pack.prototype.buildImplied=function(b){function c(n){var p=pv.Mark.stack;p.unshift(null);for(var m=0,r=n.length;m<r;m++){var s=n[m];if(!s.firstChild)s.radius=i.$radius.apply(i,(p[0]=s,p))}p.shift()}function f(n){var p=[];for(n=n.firstChild;n;n=n.nextSibling){if(n.firstChild)n.radius=f(n);n.n=n.p=n;p.push(n)}switch(b.order){case "ascending":p.sort(function(m,r){return m.radius-r.radius});break;case "descending":p.sort(function(m,r){return r.radius-m.radius});break;case "reverse":p.reverse();
break}return d(p)}function d(n){function p(B){t=Math.min(B.x-B.radius,t);x=Math.max(B.x+B.radius,x);u=Math.min(B.y-B.radius,u);o=Math.max(B.y+B.radius,o)}function m(B,F){var H=B.n;B.n=F;F.p=B;F.n=H;H.p=F}function r(B,F){B.n=F;F.p=B}function s(B,F){var H=F.x-B.x,I=F.y-B.y;B=B.radius+F.radius;return B*B-H*H-I*I>0.0010}var t=Infinity,x=-Infinity,u=Infinity,o=-Infinity,v,w,y,z,C;v=n[0];v.x=-v.radius;v.y=0;p(v);if(n.length>1){w=n[1];w.x=w.radius;w.y=0;p(w);if(n.length>2){y=n[2];g(v,w,y);p(y);m(v,y);v.p=
y;m(y,w);w=v.n;for(var A=3;A<n.length;A++){g(v,w,y=n[A]);var D=0,G=1,E=1;for(z=w.n;z!=w;z=z.n,G++)if(s(z,y)){D=1;break}if(D==1)for(C=v.p;C!=z.p;C=C.p,E++)if(s(C,y)){if(E<G){D=-1;z=C}break}if(D==0){m(v,y);w=y;p(y)}else if(D>0){r(v,z);w=z;A--}else if(D<0){r(z,w);v=z;A--}}}}v=(t+x)/2;w=(u+o)/2;for(A=y=0;A<n.length;A++){z=n[A];z.x-=v;z.y-=w;y=Math.max(y,z.radius+Math.sqrt(z.x*z.x+z.y*z.y))}return y+b.spacing}function g(n,p,m){var r=p.radius+m.radius,s=n.radius+m.radius,t=p.x-n.x;p=p.y-n.y;var x=Math.sqrt(t*
t+p*p),u=(s*s+x*x-r*r)/(2*s*x);r=Math.acos(u);u=u*s;s=Math.sin(r)*s;t/=x;p/=x;m.x=n.x+u*t+s*p;m.y=n.y+u*p-s*t}function h(n,p,m,r){for(var s=n.firstChild;s;s=s.nextSibling){s.x+=n.x;s.y+=n.y;h(s,p,m,r)}n.x=p+r*n.x;n.y=m+r*n.y;n.radius*=r}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,b)){var i=this,j=b.nodes,l=j[0];c(j);l.x=0;l.y=0;l.radius=f(l);j=this.width();var k=this.height(),q=1/Math.max(2*l.radius/j,2*l.radius/k);h(l,j/2,k/2,q)}};
pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(b,c){return Math.sqrt(c.linkValue)*1.5});this.label.textAlign("center")};
pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number);pv.Layout.Force.prototype.defaults=(new pv.Layout.Force).extend(pv.Layout.Network.prototype.defaults).dragConstant(0.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(0.9).springConstant(0.1).springDamping(0.3).springLength(20);
pv.Layout.Force.prototype.buildImplied=function(b){function c(q){return q.fix?1:q.vx*q.vx+q.vy*q.vy}if(pv.Layout.Network.prototype.buildImplied.call(this,b)){if(b=b.$force){b.next=this.binds.$force;this.binds.$force=b}}else{for(var f=this,d=b.nodes,g=b.links,h=b.iterations,i=b.width,j=b.height,l=0,k;l<d.length;l++){k=d[l];if(isNaN(k.x))k.x=i/2+40*Math.random()-20;if(isNaN(k.y))k.y=j/2+40*Math.random()-20}k=pv.simulation(d);k.force(pv.Force.drag(b.dragConstant));k.force(pv.Force.charge(b.chargeConstant).domain(b.chargeMinDistance,
b.chargeMaxDistance).theta(b.chargeTheta));k.force(pv.Force.spring(b.springConstant).damping(b.springDamping).length(b.springLength).links(g));k.constraint(pv.Constraint.position());b.bound&&k.constraint(pv.Constraint.bound().x(6,i-6).y(6,j-6));if(h==null){k.step();k.step();b.$force=this.binds.$force={next:this.binds.$force,nodes:d,min:1.0E-4*(g.length+1),sim:k};if(!this.$timer)this.$timer=setInterval(function(){for(var q=false,n=f.binds.$force;n;n=n.next)if(pv.max(n.nodes,c)>n.min){n.sim.step();
q=true}q&&f.render()},42)}else for(l=0;l<h;l++)k.step()}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var b,c=this.buildImplied;this.buildImplied=function(f){c.call(this,f);b=/^(top|bottom)$/.test(f.orient)?"step-before":/^(left|right)$/.test(f.orient)?"step-after":"linear"};this.link.interpolate(function(){return b})};
pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Cluster.prototype.defaults=(new pv.Layout.Cluster).extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");
pv.Layout.Cluster.prototype.buildImplied=function(b){if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,b)){var c=b.nodes[0],f=b.group,d,g,h=0,i=0.5-f/2,j=undefined;c.visitAfter(function(l){if(l.firstChild)l.depth=1+pv.max(l.childNodes,function(k){return k.depth});else{if(f&&j!=l.parentNode){j=l.parentNode;h+=f}h++;l.depth=0}});d=1/h;g=1/c.depth;j=undefined;c.visitAfter(function(l){if(l.firstChild)l.breadth=pv.mean(l.childNodes,function(k){return k.breadth});else{if(f&&j!=l.parentNode){j=l.parentNode;
i+=f}l.breadth=d*i++}l.depth=1-l.depth*g});c.visitAfter(function(l){l.minBreadth=l.firstChild?l.firstChild.minBreadth:l.breadth-d/2;l.maxBreadth=l.firstChild?l.lastChild.maxBreadth:l.breadth+d/2});c.visitBefore(function(l){l.minDepth=l.parentNode?l.parentNode.maxDepth:0;l.maxDepth=l.parentNode?l.depth+c.depth:l.minDepth+2*c.depth});c.minDepth=-g;pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,b)}};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};
pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.buildImplied=function(b){pv.Layout.Cluster.prototype.buildImplied.call(this,b)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,b)};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);
pv.Layout.Partition.prototype.defaults=(new pv.Layout.Partition).extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");pv.Layout.Partition.prototype.$size=function(){return 1};pv.Layout.Partition.prototype.size=function(b){this.$size=b;return this};
pv.Layout.Partition.prototype.buildImplied=function(b){if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,b)){var c=this,f=b.nodes[0],d=pv.Mark.stack,g=0;d.unshift(null);f.visitAfter(function(i,j){if(j>g)g=j;i.size=i.firstChild?pv.sum(i.childNodes,function(l){return l.size}):c.$size.apply(c,(d[0]=i,d))});d.shift();switch(b.order){case "ascending":f.sort(function(i,j){return i.size-j.size});break;case "descending":f.sort(function(i,j){return j.size-i.size});break}var h=1/g;f.minBreadth=0;f.breadth=
0.5;f.maxBreadth=1;f.visitBefore(function(i){for(var j=i.minBreadth,l=i.maxBreadth-j,k=i.firstChild;k;k=k.nextSibling){k.minBreadth=j;k.maxBreadth=j+=k.size/i.size*l;k.breadth=(j+k.minBreadth)/2}});f.visitAfter(function(i,j){i.minDepth=(j-1)*h;i.maxDepth=i.depth=j*h});pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,b)}};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);
pv.Layout.Partition.Fill.prototype.buildImplied=function(b){pv.Layout.Partition.prototype.buildImplied.call(this,b)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,b)};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var b,c,f,d=this.buildImplied;this.buildImplied=function(g){d.call(this,g);c=g.directed;b=g.orient=="radial"?"linear":"polar";f=g.orient=="right"||g.orient=="top"};this.link.data(function(g){var h=g.sourceNode;g=g.targetNode;return f!=(c||h.breadth<g.breadth)?[h,g]:[g,h]}).interpolate(function(){return b})};
pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=(new pv.Layout.Arc).extend(pv.Layout.Network.prototype.defaults).orient("bottom");pv.Layout.Arc.prototype.sort=function(b){this.$sort=b;return this};
pv.Layout.Arc.prototype.buildImplied=function(b){function c(m){switch(h){case "top":return-Math.PI/2;case "bottom":return Math.PI/2;case "left":return Math.PI;case "right":return 0;case "radial":return(m-0.25)*2*Math.PI}}function f(m){switch(h){case "top":case "bottom":return m*l;case "left":return 0;case "right":return l;case "radial":return l/2+q*Math.cos(c(m))}}function d(m){switch(h){case "top":return 0;case "bottom":return k;case "left":case "right":return m*k;case "radial":return k/2+q*Math.sin(c(m))}}
if(!pv.Layout.Network.prototype.buildImplied.call(this,b)){var g=b.nodes,h=b.orient,i=this.$sort,j=pv.range(g.length),l=b.width,k=b.height,q=Math.min(l,k)/2;i&&j.sort(function(m,r){return i(g[m],g[r])});for(b=0;b<g.length;b++){var n=g[j[b]],p=n.breadth=(b+0.5)/g.length;n.x=f(p);n.y=d(p);n.midAngle=c(p)}}};
pv.Layout.Horizon=function(){pv.Layout.call(this);var b=this,c,f,d,g,h,i,j=this.buildImplied;this.buildImplied=function(l){j.call(this,l);c=l.bands;f=l.mode;d=Math.round((f=="color"?0.5:1)*l.height);g=l.backgroundStyle;h=pv.ramp(g,l.negativeStyle).domain(0,c);i=pv.ramp(g,l.positiveStyle).domain(0,c)};c=(new pv.Panel).data(function(){return pv.range(c*2)}).overflow("hidden").height(function(){return d}).top(function(l){return f=="color"?(l&1)*d:0}).fillStyle(function(l){return l?null:g});this.band=
(new pv.Mark).top(function(l,k){return f=="mirror"&&k&1?(k+1>>1)*d:null}).bottom(function(l,k){return f=="mirror"?k&1?null:(k+1>>1)*-d:(k&1||-1)*(k+1>>1)*d}).fillStyle(function(l,k){return(k&1?h:i)((k>>1)+1)});this.band.add=function(l){return b.add(pv.Panel).extend(c).add(l).extend(this)}};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("positiveStyle",pv.color).property("negativeStyle",pv.color);
pv.Layout.Horizon.prototype.defaults=(new pv.Layout.Horizon).extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728");
pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var b=this,c,f,d=b.buildImplied;this.buildImplied=function(g){d.call(this,g);c=g.$rollup.nodes;f=g.$rollup.links};this.node.data(function(){return c}).size(function(g){return g.nodes.length*20});this.link.interpolate("polar").eccentricity(0.8);this.link.add=function(g){return b.add(pv.Panel).data(function(){return f}).add(g).extend(this)}};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);
pv.Layout.Rollup.prototype.x=function(b){this.$x=pv.functor(b);return this};pv.Layout.Rollup.prototype.y=function(b){this.$y=pv.functor(b);return this};
pv.Layout.Rollup.prototype.buildImplied=function(b){function c(r){return i[r]+","+j[r]}if(!pv.Layout.Network.prototype.buildImplied.call(this,b)){var f=b.nodes,d=b.links,g=b.directed,h=f.length,i=[],j=[],l=0,k={},q={},n=pv.Mark.stack,p={parent:this};n.unshift(null);for(var m=0;m<h;m++){p.index=m;n[0]=f[m];i[m]=this.$x.apply(p,n);j[m]=this.$y.apply(p,n)}n.shift();for(m=0;m<f.length;m++){h=c(m);n=k[h];if(!n){n=k[h]=pv.extend(f[m]);n.index=l++;n.x=i[m];n.y=j[m];n.nodes=[]}n.nodes.push(f[m])}for(m=0;m<
d.length;m++){l=d[m].targetNode;f=k[c(d[m].sourceNode.index)];l=k[c(l.index)];h=!g&&f.index>l.index?l.index+","+f.index:f.index+","+l.index;(n=q[h])||(n=q[h]={sourceNode:f,targetNode:l,linkValue:0,links:[]});n.links.push(d[m]);n.linkValue+=d[m].linkValue}b.$rollup={nodes:pv.values(k),links:pv.values(q)}}};
pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var b,c,f,d,g,h=this.buildImplied;this.buildImplied=function(i){h.call(this,i);b=i.nodes.length;c=i.width/b;f=i.height/b;d=i.$matrix.labels;g=i.$matrix.pairs};this.link.data(function(){return g}).left(function(){return c*(this.index%b)}).top(function(){return f*Math.floor(this.index/b)}).width(function(){return c}).height(function(){return f}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(i){return i.linkValue?"#555":"#eee"}).parent=
this;delete this.link.add;this.label.data(function(){return d}).left(function(){return this.index&1?c*((this.index>>1)+0.5):0}).top(function(){return this.index&1?0:f*((this.index>>1)+0.5)}).textMargin(4).textAlign(function(){return this.index&1?"left":"right"}).textAngle(function(){return this.index&1?-Math.PI/2:0});delete this.node};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(b){this.$sort=b;return this};
pv.Layout.Matrix.prototype.buildImplied=function(b){if(!pv.Layout.Network.prototype.buildImplied.call(this,b)){var c=b.nodes,f=b.links,d=this.$sort,g=c.length,h=pv.range(g),i=[],j=[],l={};b.$matrix={labels:i,pairs:j};d&&h.sort(function(m,r){return d(c[m],c[r])});for(var k=0;k<g;k++)for(var q=0;q<g;q++){var n=h[k],p=h[q];j.push(l[n+"."+p]={row:k,col:q,sourceNode:c[n],targetNode:c[p],linkValue:0})}for(k=0;k<g;k++){n=h[k];i.push(c[n],c[n])}for(k=0;k<f.length;k++){i=f[k];g=i.sourceNode.index;h=i.targetNode.index;
i=i.linkValue;l[g+"."+h].linkValue+=i;b.directed||(l[h+"."+g].linkValue+=i)}}};
pv.Layout.Bullet=function(){pv.Layout.call(this);var b=this,c=b.buildImplied,f=b.x=pv.Scale.linear(),d,g,h,i,j;this.buildImplied=function(l){c.call(this,j=l);d=l.orient;g=/^left|right$/.test(d);h=pv.ramp("#bbb","#eee").domain(0,Math.max(1,j.ranges.length-1));i=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,j.measures.length-1))};(this.range=new pv.Mark).data(function(){return j.ranges}).reverse(true).left(function(){return d=="left"?0:null}).top(function(){return d=="top"?0:null}).right(function(){return d==
"right"?0:null}).bottom(function(){return d=="bottom"?0:null}).width(function(l){return g?f(l):null}).height(function(l){return g?null:f(l)}).fillStyle(function(){return h(this.index)}).antialias(false).parent=b;(this.measure=new pv.Mark).extend(this.range).data(function(){return j.measures}).left(function(){return d=="left"?0:g?null:this.parent.width()/3.25}).top(function(){return d=="top"?0:g?this.parent.height()/3.25:null}).right(function(){return d=="right"?0:g?null:this.parent.width()/3.25}).bottom(function(){return d==
"bottom"?0:g?this.parent.height()/3.25:null}).fillStyle(function(){return i(this.index)}).parent=b;(this.marker=new pv.Mark).data(function(){return j.markers}).left(function(l){return d=="left"?f(l):g?null:this.parent.width()/2}).top(function(l){return d=="top"?f(l):g?this.parent.height()/2:null}).right(function(l){return d=="right"?f(l):null}).bottom(function(l){return d=="bottom"?f(l):null}).strokeStyle("black").shape("bar").angle(function(){return g?0:Math.PI/2}).parent=b;(this.tick=new pv.Mark).data(function(){return f.ticks(7)}).left(function(l){return d==
"left"?f(l):null}).top(function(l){return d=="top"?f(l):null}).right(function(l){return d=="right"?f(l):g?null:-6}).bottom(function(l){return d=="bottom"?f(l):g?-8:null}).height(function(){return g?6:null}).width(function(){return g?null:6}).parent=b};pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("maximum",Number);pv.Layout.Bullet.prototype.defaults=(new pv.Layout.Bullet).extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]);
pv.Layout.Bullet.prototype.buildImplied=function(b){pv.Layout.prototype.buildImplied.call(this,b);var c=this.parent[/^left|right$/.test(b.orient)?"width":"height"]();b.maximum=b.maximum||pv.max([].concat(b.ranges,b.markers,b.measures));this.x.domain(0,b.maximum).range(0,c)};pv.Behavior={};
pv.Behavior.drag=function(){function b(l){g=this.index;d=this.scene;var k=this.mouse();i=((h=l).fix=pv.vector(l.x,l.y)).minus(k);j={x:this.parent.width()-(l.dx||0),y:this.parent.height()-(l.dy||0)};d.mark.context(d,g,function(){this.render()});pv.Mark.dispatch("dragstart",d,g)}function c(){if(d){d.mark.context(d,g,function(){var l=this.mouse();h.x=h.fix.x=Math.max(0,Math.min(i.x+l.x,j.x));h.y=h.fix.y=Math.max(0,Math.min(i.y+l.y,j.y));this.render()});pv.Mark.dispatch("drag",d,g)}}function f(){if(d){h.fix=
null;d.mark.context(d,g,function(){this.render()});pv.Mark.dispatch("dragend",d,g);d=null}}var d,g,h,i,j;pv.listen(window,"mousemove",c);pv.listen(window,"mouseup",f);return b};
pv.Behavior.point=function(b){function c(k,q){k=k[q];q={cost:Infinity};for(var n=0,p=k.visible&&k.children.length;n<p;n++){var m=k.children[n],r=m.mark,s;if(r.type=="panel"){r.scene=m;for(var t=0,x=m.length;t<x;t++){r.index=t;s=c(m,t);if(s.cost<q.cost)q=s}delete r.scene;delete r.index}else if(r.$handlers.point){r=r.mouse();t=0;for(x=m.length;t<x;t++){var u=m[t];s=r.x-u.left-(u.width||0)/2;u=r.y-u.top-(u.height||0)/2;var o=i*s*s+j*u*u;if(o<q.cost){q.distance=s*s+u*u;q.cost=o;q.scene=m;q.index=t}}}}return q}
function f(){var k=c(this.scene,this.index);if(k.cost==Infinity||k.distance>l)k=null;if(g){if(k&&g.scene==k.scene&&g.index==k.index)return;pv.Mark.dispatch("unpoint",g.scene,g.index)}if(g=k){pv.Mark.dispatch("point",k.scene,k.index);pv.listen(this.root.canvas(),"mouseout",d)}}function d(k){if(g&&!pv.ancestor(this,k.relatedTarget)){pv.Mark.dispatch("unpoint",g.scene,g.index);g=null}}var g,h=null,i=1,j=1,l=arguments.length?b*b:900;f.collapse=function(k){if(arguments.length){h=String(k);switch(h){case "y":i=
1;j=0;break;case "x":i=0;j=1;break;default:j=i=1;break}return f}return h};return f};
pv.Behavior.select=function(){function b(j){g=this.index;d=this.scene;i=this.mouse();h=j;h.x=i.x;h.y=i.y;h.dx=h.dy=0;pv.Mark.dispatch("selectstart",d,g)}function c(){if(d){d.mark.context(d,g,function(){var j=this.mouse();h.x=Math.max(0,Math.min(i.x,j.x));h.y=Math.max(0,Math.min(i.y,j.y));h.dx=Math.min(this.width(),Math.max(j.x,i.x))-h.x;h.dy=Math.min(this.height(),Math.max(j.y,i.y))-h.y;this.render()});pv.Mark.dispatch("select",d,g)}}function f(){if(d){pv.Mark.dispatch("selectend",d,g);d=null}}var d,
g,h,i;pv.listen(window,"mousemove",c);pv.listen(window,"mouseup",f);return b};
pv.Behavior.resize=function(b){function c(l){h=this.index;g=this.scene;j=this.mouse();i=l;switch(b){case "left":j.x=i.x+i.dx;break;case "right":j.x=i.x;break;case "top":j.y=i.y+i.dy;break;case "bottom":j.y=i.y;break}pv.Mark.dispatch("resizestart",g,h)}function f(){if(g){g.mark.context(g,h,function(){var l=this.mouse();i.x=Math.max(0,Math.min(j.x,l.x));i.y=Math.max(0,Math.min(j.y,l.y));i.dx=Math.min(this.parent.width(),Math.max(l.x,j.x))-i.x;i.dy=Math.min(this.parent.height(),Math.max(l.y,j.y))-i.y;
this.render()});pv.Mark.dispatch("resize",g,h)}}function d(){if(g){pv.Mark.dispatch("resizeend",g,h);g=null}}var g,h,i,j;pv.listen(window,"mousemove",f);pv.listen(window,"mouseup",d);return c};
pv.Behavior.pan=function(){function b(){g=this.index;d=this.scene;i=pv.vector(pv.event.pageX,pv.event.pageY);h=this.transform();j=1/(h.k*this.scale);if(l)l={x:(1-h.k)*this.width(),y:(1-h.k)*this.height()}}function c(){if(d){d.mark.context(d,g,function(){var k=h.translate((pv.event.pageX-i.x)*j,(pv.event.pageY-i.y)*j);if(l){k.x=Math.max(l.x,Math.min(0,k.x));k.y=Math.max(l.y,Math.min(0,k.y))}this.transform(k).render()});pv.Mark.dispatch("pan",d,g)}}function f(){d=null}var d,g,h,i,j,l;b.bound=function(k){if(arguments.length){l=
Boolean(k);return this}return Boolean(l)};pv.listen(window,"mousemove",c);pv.listen(window,"mouseup",f);return b};
pv.Behavior.zoom=function(b){function c(){var d=this.mouse(),g=pv.event.wheel*b;d=this.transform().translate(d.x,d.y).scale(g<0?1E3/(1E3-g):(1E3+g)/1E3).translate(-d.x,-d.y);if(f){d.k=Math.max(1,d.k);d.x=Math.max((1-d.k)*this.width(),Math.min(0,d.x));d.y=Math.max((1-d.k)*this.height(),Math.min(0,d.y))}this.transform(d).render();pv.Mark.dispatch("zoom",this.scene,this.index)}var f;arguments.length||(b=1/48);c.bound=function(d){if(arguments.length){f=Boolean(d);return this}return Boolean(f)};return c};
pv.Geo=function(){};
pv.Geo.projections={mercator:{project:function(b){return{x:b.lng/180,y:b.lat>85?1:b.lat<-85?-1:Math.log(Math.tan(Math.PI/4+pv.radians(b.lat)/2))/Math.PI}},invert:function(b){return{lng:b.x*180,lat:pv.degrees(2*Math.atan(Math.exp(b.y*Math.PI))-Math.PI/2)}}},"gall-peters":{project:function(b){return{x:b.lng/180,y:Math.sin(pv.radians(b.lat))}},invert:function(b){return{lng:b.x*180,lat:pv.degrees(Math.asin(b.y))}}},sinusoidal:{project:function(b){return{x:pv.radians(b.lng)*Math.cos(pv.radians(b.lat))/Math.PI,
y:b.lat/90}},invert:function(b){return{lng:pv.degrees(b.x*Math.PI/Math.cos(b.y*Math.PI/2)),lat:b.y*90}}},aitoff:{project:function(b){var c=pv.radians(b.lng);b=pv.radians(b.lat);var f=Math.acos(Math.cos(b)*Math.cos(c/2));return{x:2*(f?Math.cos(b)*Math.sin(c/2)*f/Math.sin(f):0)/Math.PI,y:2*(f?Math.sin(b)*f/Math.sin(f):0)/Math.PI}},invert:function(b){var c=b.y*Math.PI/2;return{lng:pv.degrees(b.x*Math.PI/2/Math.cos(c)),lat:pv.degrees(c)}}},hammer:{project:function(b){var c=pv.radians(b.lng);b=pv.radians(b.lat);
var f=Math.sqrt(1+Math.cos(b)*Math.cos(c/2));return{x:2*Math.SQRT2*Math.cos(b)*Math.sin(c/2)/f/3,y:Math.SQRT2*Math.sin(b)/f/1.5}},invert:function(b){var c=b.x*3;b=b.y*1.5;var f=Math.sqrt(1-c*c/16-b*b/4);return{lng:pv.degrees(2*Math.atan2(f*c,2*(2*f*f-1))),lat:pv.degrees(Math.asin(f*b))}}},identity:{project:function(b){return{x:b.lng/180,y:b.lat/90}},invert:function(b){return{lng:b.x*180,lat:b.y*90}}}};
pv.Geo.scale=function(b){function c(m){if(!n||m.lng!=n.lng||m.lat!=n.lat){n=m;m=f(m);p={x:l(m.x),y:k(m.y)}}return p}function f(m){return j.project({lng:m.lng-q.lng,lat:m.lat})}function d(m){m=j.invert(m);m.lng+=q.lng;return m}var g={x:0,y:0},h={x:1,y:1},i=[],j=pv.Geo.projections.identity,l=pv.Scale.linear(-1,1).range(0,1),k=pv.Scale.linear(-1,1).range(1,0),q={lng:0,lat:0},n,p;c.x=function(m){return c(m).x};c.y=function(m){return c(m).y};c.ticks={lng:function(m){var r;if(i.length>1){var s=pv.Scale.linear();
if(m==undefined)m=10;r=s.domain(i,function(t){return t.lat}).ticks(m);m=s.domain(i,function(t){return t.lng}).ticks(m)}else{r=pv.range(-80,81,10);m=pv.range(-180,181,10)}return m.map(function(t){return r.map(function(x){return{lat:x,lng:t}})})},lat:function(m){return pv.transpose(c.ticks.lng(m))}};c.invert=function(m){return d({x:l.invert(m.x),y:k.invert(m.y)})};c.domain=function(m,r){if(arguments.length){i=m instanceof Array?arguments.length>1?pv.map(m,r):m:Array.prototype.slice.call(arguments);
if(i.length>1){var s=i.map(function(x){return x.lng}),t=i.map(function(x){return x.lat});q={lng:(pv.max(s)+pv.min(s))/2,lat:(pv.max(t)+pv.min(t))/2};s=i.map(f);l.domain(s,function(x){return x.x});k.domain(s,function(x){return x.y})}else{q={lng:0,lat:0};l.domain(-1,1);k.domain(-1,1)}n=null;return this}return i};c.range=function(m,r){if(arguments.length){if(typeof m=="object"){g={x:Number(m.x),y:Number(m.y)};h={x:Number(r.x),y:Number(r.y)}}else{g={x:0,y:0};h={x:Number(m),y:Number(r)}}l.range(g.x,h.x);
k.range(h.y,g.y);n=null;return this}return[g,h]};c.projection=function(m){if(arguments.length){j=typeof m=="string"?pv.Geo.projections[m]||pv.Geo.projections.identity:m;return this.domain(i)}return m};c.by=function(m){function r(){return c(m.apply(this,arguments))}for(var s in c)r[s]=c[s];return r};arguments.length&&c.projection(b);return c};
